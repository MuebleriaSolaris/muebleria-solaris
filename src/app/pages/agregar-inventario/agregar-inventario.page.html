<ion-header>
  <ion-toolbar color="primary">
    <ion-title>Agregar Inventario</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div class="form-card">
    <h2>Introduce los detalles del producto</h2>

    <!-- Formulario para agregar producto -->
    <form (submit)="saveProduct()">
      <ion-list lines="none" class="custom-form-list">
        <!-- Nombre del Producto -->
        <div class="form-group">
          <label class="floating-label" [class.shrink]="hasValue(newProduct.name)">Nombre del Producto</label>
          <input 
            [(ngModel)]="newProduct.name" 
            class="native-input"
            name="name" 
            required
          >
        </div>
      
        <!-- Categoría -->
        <div class="form-group">
          <label class="floating-label" [class.shrink]="hasValue(newProduct.category_id)">Categoría</label>
          <select
            [(ngModel)]="newProduct.category_id"
            class="native-select"
            name="category_id"
            required
          >
            <option value="" disabled selected hidden>Seleccione una</option>
            <option *ngFor="let category of categories" [value]="category.id">{{ category.name }}</option>
          </select>
        </div>
      
        <!-- Subcategoría -->
        <div class="form-group">
          <label class="floating-label" [class.shrink]="hasValue(newProduct.sub_category_id)">Subcategoría</label>
          <select
            [(ngModel)]="newProduct.sub_category_id"
            class="native-select"
            name="sub_category_id"
            required
          >
            <option value="" disabled selected hidden>Seleccione una</option>
            <option *ngFor="let subCategory of subCategories" [value]="subCategory.id">{{ subCategory.name }}</option>
          </select>
        </div>
      
        <!-- Proveedores -->
        <div class="form-group">
          <label class="floating-label" [class.shrink]="hasValue(newProduct.proveedor_id)">Proveedor</label>
          <select
            [(ngModel)]="newProduct.proveedor_id"
            class="native-select"
            name="proveedor_id"
            required
          >
            <option value="" disabled selected hidden>Seleccione un proveedor</option>
            <option *ngFor="let provider of providers" [value]="provider.id">{{ provider.name }}</option>
          </select>
        </div>
      
        <!-- Detalles del Producto -->
        <div class="form-group">
          <label class="floating-label" [class.shrink]="hasValue(newProduct.product_details)">Detalles del Producto</label>
          <textarea
            [(ngModel)]="newProduct.product_details"
            class="native-textarea"
            name="product_details"
            rows="3"
            style="width: 100%;"
          ></textarea>
        </div>
      
        <!-- Novedad -->
        <div class="form-toggle-group"  style="margin-bottom: 25px; text-align: center;">
          <label style="margin-right: 5px;">Novedad</label>
          <input 
            type="checkbox" 
            [(ngModel)]="newProduct.novedad_act"
            name="novedad_act"
            class="native-toggle"
            (change)="toggleNovedad($event)"
          >
        </div>
      
        <!-- Precio de Crédito -->
        <div class="form-group">
          <label class="floating-label" [class.shrink]="hasValue(newProduct.credit_price)" >Precio de Crédito</label>
          <input 
            [(ngModel)]="newProduct.credit_price" 
            class="native-input"
            name="credit_price" 
            type="number" 
            required
          >
        </div>
      
        <!-- Precio de Proveedor (solo para gerente) -->
        <div class="form-group" *ngIf="esGerente">
          <label class="floating-label" [class.shrink]="hasValue(newProduct.prov_price)">Precio de Proveedor</label>
          <input 
            [(ngModel)]="newProduct.prov_price" 
            class="native-input"
            name="prov_price" 
            type="number" 
            required
          >
        </div>

        <!-- Cantidad Máxima -->
        <div class="form-group" *ngIf="esGerente">
          <label class="floating-label" [class.shrink]="hasValue(newProduct.max_amount)">Cantidad Máxima</label>
          <input 
            [(ngModel)]="newProduct.max_amount" 
            (change)="validateCurrentAmount()"
            class="native-input"
            name="max_amount" 
            type="number" 
            required
            [value]="newProduct.max_amount"
          >
        </div>

        <!-- Cantidad Actual -->
        <div class="form-group" *ngIf="esGerente">
          <label class="floating-label" [class.shrink]="hasValue(newProduct.current_amount)">Cantidad Actual</label>
          <input 
            [(ngModel)]="newProduct.current_amount" 
            (change)="validateCurrentAmount()"
            class="native-input"
            name="current_amount" 
            type="number" 
            required
            [value]="newProduct.current_amount"
          >
        </div>
      
        <!-- Marca -->
        <div class="form-group">
          <label class="floating-label" [class.shrink]="hasValue(newProduct.brand_id)">Marca</label>
          <select
            [(ngModel)]="newProduct.brand_id"
            class="native-select"
            name="brand_id"
            required
          >
            <option value="" disabled selected hidden>Seleccione una</option>
            <option *ngFor="let brand of brands" [value]="brand.id">{{ brand.name }}</option>
          </select>
        </div>
      
        <!-- Imagen del Producto (se mantiene como ion-avatar) -->
        <div class="form-image-group" style="text-align: center;">
          <label>Imagen del Producto</label>
          <ion-avatar class="image-preview" (click)="presentImageOptions()" style="margin-top: 10px;">
            <img [src]="imageUrl || 'assets/product_placeholder.png'" alt="Imagen del Producto" />
          </ion-avatar>
        </div>
      </ion-list>

      <!-- Botón Guardar -->
      <!-- <ion-footer class="footer edit-footer">
        <ion-button class="guardar-button" expand="block" color="success" type="submit">
          <ion-icon slot="start" name="checkmark-outline"></ion-icon>
          Guardar Producto
        </ion-button>
      </ion-footer> -->
      <div class="form-footer">
        <button type="submit" class="native-button" color="success">
          <ion-icon name="checkmark-outline"></ion-icon>
          Guardar Producto
        </button>
      </div>
    </form>
  </div>
</ion-content>
