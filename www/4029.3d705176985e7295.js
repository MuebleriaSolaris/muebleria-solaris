"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4029],{4029:(U,f,l)=>{l.r(f),l.d(f,{AgregarInventarioPageModule:()=>O});var h=l(177),s=l(4341),c=l(7125),_=l(620),g=l(467),v=l(3114),w=l(2704),b=l(2406),I=l(3207),e=l(4438),C=l(4934),y=l(3656),M=l(1626),A=l(4796);function F(t,d){if(1&t&&(e.j41(0,"option",25),e.EFF(1),e.k0s()),2&t){const o=d.$implicit;e.Y8G("value",o.id),e.R7$(),e.JRh(o.name)}}function E(t,d){if(1&t&&(e.j41(0,"option",25),e.EFF(1),e.k0s()),2&t){const o=d.$implicit;e.Y8G("value",o.id),e.R7$(),e.JRh(o.name)}}function R(t,d){if(1&t&&(e.j41(0,"option",25),e.EFF(1),e.k0s()),2&t){const o=d.$implicit;e.Y8G("value",o.id),e.R7$(),e.JRh(o.name)}}function j(t,d){if(1&t){const o=e.RV6();e.j41(0,"div",4)(1,"label",5),e.EFF(2,"Precio de Proveedor"),e.k0s(),e.j41(3,"input",26),e.mxI("ngModelChange",function(r){e.eBV(o);const i=e.XpG();return e.DH7(i.newProduct.prov_price,r)||(i.newProduct.prov_price=r),e.Njj(r)}),e.k0s()()}if(2&t){const o=e.XpG();e.R7$(),e.AVh("shrink",o.hasValue(o.newProduct.prov_price)),e.R7$(2),e.R50("ngModel",o.newProduct.prov_price)}}function k(t,d){if(1&t){const o=e.RV6();e.j41(0,"div",4)(1,"label",5),e.EFF(2,"Cantidad M\xe1xima"),e.k0s(),e.j41(3,"input",27),e.mxI("ngModelChange",function(r){e.eBV(o);const i=e.XpG();return e.DH7(i.newProduct.max_amount,r)||(i.newProduct.max_amount=r),e.Njj(r)}),e.bIt("change",function(){e.eBV(o);const r=e.XpG();return e.Njj(r.validateCurrentAmount())}),e.k0s()()}if(2&t){const o=e.XpG();e.R7$(),e.AVh("shrink",o.hasValue(o.newProduct.max_amount)),e.R7$(2),e.R50("ngModel",o.newProduct.max_amount),e.Y8G("value",o.newProduct.max_amount)}}function x(t,d){if(1&t){const o=e.RV6();e.j41(0,"div",4)(1,"label",5),e.EFF(2,"Cantidad Actual"),e.k0s(),e.j41(3,"input",28),e.mxI("ngModelChange",function(r){e.eBV(o);const i=e.XpG();return e.DH7(i.newProduct.current_amount,r)||(i.newProduct.current_amount=r),e.Njj(r)}),e.bIt("change",function(){e.eBV(o);const r=e.XpG();return e.Njj(r.validateCurrentAmount())}),e.k0s()()}if(2&t){const o=e.XpG();e.R7$(),e.AVh("shrink",o.hasValue(o.newProduct.current_amount)),e.R7$(2),e.R50("ngModel",o.newProduct.current_amount),e.Y8G("value",o.newProduct.current_amount)}}function G(t,d){if(1&t&&(e.j41(0,"option",25),e.EFF(1),e.k0s()),2&t){const o=d.$implicit;e.Y8G("value",o.id),e.R7$(),e.JRh(o.name)}}const V=[{path:"",component:(()=>{var t;class d{constructor(n,r,i,a,p,m,u,P,S){this.inventoryService=n,this.navCtrl=r,this.alertController=i,this.router=a,this.http=p,this.authService=m,this.actionSheetController=u,this.modalController=P,this.loadingController=S,this.newProduct={name:"",category_id:null,sub_category_id:null,product_details:"",novedad_act:0,credit_price:null,brand_id:null,proveedor_id:null,prov_price:null,max_amount:null,current_amount:null},this.categories=[],this.subCategories=[],this.brands=[],this.providers=[],this.nextProductId=null,this.selectedImage=null,this.esGerente=!1,this.imageUrl=null}ngOnInit(){const n=this.authService.getUserId();n&&this.http.get(`https://muebleriasolaris.com/ionic-login/check_gerencia.php?userid=${n}`).subscribe(r=>{r.success?this.esGerente=r.isGerente:console.error("Error en la respuesta de la API:",r.error),console.log("\xbfEs gerente?",this.esGerente),console.log("ID de usuario:",n)},r=>{console.error("Error en la llamada HTTP:",r)}),this.loadCategories(),this.loadBrands(),this.loadSubCategories(),this.loadprovider()}hasValue(n){return null!=n&&""!==n}getNextProductId(){var n=this;return(0,g.A)(function*(){try{const r=yield n.http.get("https://muebleriasolaris.com/ionic-products/get_next_product_id.php").toPromise();if("success"!==r.status)throw new Error(r.message);n.nextProductId=r.next_id}catch(r){console.error("Error al obtener el siguiente ID:",r),yield n.showAlert("Error","No se pudo obtener el siguiente ID del producto.")}})()}viewImage(){var n=this;return(0,g.A)(function*(){n.imageUrl?yield(yield n.modalController.create({component:w.d,componentProps:{imageUrl:n.imageUrl}})).present():yield n.showAlert("Error","No hay imagen para mostrar.")})()}uploadImage(n){var r=this;return(0,g.A)(function*(){if(!r.nextProductId)return void(yield r.showAlert("Error","No se ha obtenido un ID v\xe1lido para el producto."));const i=yield r.loadingController.create({message:"Subiendo imagen...",spinner:"crescent"});yield i.present();try{const p=yield(yield fetch(n)).blob(),m=new FormData;m.append("image",p,`product_${r.nextProductId}.jpg`),m.append("product_id",r.nextProductId.toString()),yield(0,I.s)(r.http.post("https://muebleriasolaris.com/ionic-products/ftp_image_upload.php",m)).then(u=>{if("success"!==u.status)throw new Error(u.message||"No se pudo subir la imagen.");r.selectedImage=u.image_url,r.imageUrl=u.image_url,console.log("Imagen subida correctamente:",r.imageUrl),r.showAlert("\xc9xito","Imagen subida correctamente.")})}catch(a){console.error("Error al subir la imagen:",a),yield r.showAlert("Error","Ocurri\xf3 un error al subir la imagen.")}finally{yield i.dismiss()}})()}deleteImage(){var n=this;return(0,g.A)(function*(){n.imageUrl="assets/product_placeholder.png",n.selectedImage="assets/product_placeholder.png",n.showAlert("\xc9xito","Imagen eliminada correctamente.")})()}changeImage(){var n=this;return(0,g.A)(function*(){try{const r=yield v.i7.getPhoto({quality:90,allowEditing:!1,resultType:v.LK.Uri,source:v.ru.Photos});r.webPath&&(yield n.getNextProductId(),yield n.uploadImage(r.webPath))}catch(r){console.error("Error al seleccionar la imagen:",r)}})()}presentImageOptions(){var n=this;return(0,g.A)(function*(){console.log("Click en Imagen"),yield(yield n.actionSheetController.create({header:"Opciones de imagen",buttons:[{text:"Cambiar imagen",icon:"image",handler:()=>{n.changeImage()}},{text:"Eliminar imagen",icon:"trash",handler:()=>{n.deleteImage()}},{text:"Ver imagen",icon:"eye-outline",handler:()=>{n.viewImage()}},{text:"Cancelar",icon:"close",role:"cancel"}]})).present()})()}showAlert(n,r){var i=this;return(0,g.A)(function*(){yield(yield i.alertController.create({header:n,message:r,buttons:["OK"]})).present()})()}loadCategories(){var n=this;this.inventoryService.getCategories().subscribe(r=>{r.success&&(this.categories=r.data)},function(){var r=(0,g.A)(function*(i){console.error("Error al cargar categor\xedas:",i),yield n.showAlert("Error","No se pudieron cargar las categor\xedas")});return function(i){return r.apply(this,arguments)}}())}loadSubCategories(){this.inventoryService.getSubCategories().subscribe(n=>{n.success&&(this.subCategories=n.data)},n=>{console.error("Error al cargar categor\xedas:",n)})}loadBrands(){this.inventoryService.getBrands().subscribe(n=>{n.success&&(this.brands=n.data)},n=>{console.error("Error al cargar marcas:",n)})}loadprovider(){this.inventoryService.getProviders().subscribe(n=>{n.success&&(this.providers=n.data)},n=>{console.error("Error al cargar proveedores:",n)})}resetForm(){this.newProduct={name:"",category_id:null,sub_category_id:null,product_details:"",novedad_act:0,credit_price:null,brand_id:null,proveedor_id:null,max_amount:null,current_amount:null}}toggleNovedad(n){this.newProduct.novedad_act=n.detail.checked?1:0}validateCurrentAmount(){null!==this.newProduct.max_amount&&null!==this.newProduct.current_amount&&this.newProduct.current_amount>this.newProduct.max_amount&&(this.showAlert("Valor inv\xe1lido","La cantidad actual no puede ser mayor que el stock m\xe1ximo"),this.newProduct.current_amount=this.newProduct.max_amount)}saveProduct(){var n=this;return(0,g.A)(function*(){const{name:r}=n.newProduct;if(!r)return void(yield n.showAlert("Campo obligatorio","Por favor, ingresa el nombre del producto."));const i={name:n.newProduct.name,category_id:n.newProduct.category_id||14,sub_category_id:n.newProduct.sub_category_id||31,brand_id:n.newProduct.brand_id||1,credit_price:n.newProduct.credit_price||0,proveedor_id:n.newProduct.proveedor_id||10,product_details:n.newProduct.product_details||"",novedad_act:n.newProduct.novedad_act?1:0,prov_price:n.newProduct.prov_price||0,image_url:n.imageUrl,max_amount:n.newProduct.max_amount||15,current_amount:n.newProduct.current_amount||10};var p;yield(yield n.alertController.create({header:"Confirmar",message:"\xbfEst\xe1s seguro de que deseas guardar este producto?",buttons:[{text:"Cancelar",role:"cancel"},{text:"Guardar",handler:(p=(0,g.A)(function*(){const m=yield n.loadingController.create({message:"Guardando producto...",spinner:"bubbles"});yield m.present();try{const u=yield(0,I.s)(n.inventoryService.addInventory(i));if(!u.success)throw new Error(u.message||"Error al guardar el producto");yield n.showAlert("\xc9xito","Producto agregado correctamente"),n.router.navigate(["/inventario"]).then(()=>{typeof b.X.refreshData<"u"&&b.X.refreshData.next()})}catch(u){console.error("Error:",u);const P=u.message||"Error en el servidor";yield n.showAlert("Error",P)}finally{yield m.dismiss()}}),function(){return p.apply(this,arguments)})}]})).present()})()}}return(t=d).\u0275fac=function(n){return new(n||t)(e.rXU(C.c),e.rXU(y.q9),e.rXU(c.hG),e.rXU(_.Ix),e.rXU(M.Qq),e.rXU(A.u),e.rXU(c.GD),e.rXU(c.W3),e.rXU(c.Xi))},t.\u0275cmp=e.VBU({type:t,selectors:[["app-agregar-inventario"]],decls:66,vars:30,consts:[["color","primary"],[1,"form-card"],[3,"submit"],["lines","none",1,"custom-form-list"],[1,"form-group"],[1,"floating-label"],["name","name","required","",1,"native-input",3,"ngModelChange","ngModel"],["name","category_id","required","",1,"native-select",3,"ngModelChange","ngModel"],["value","","disabled","","selected","","hidden",""],[3,"value",4,"ngFor","ngForOf"],["name","sub_category_id","required","",1,"native-select",3,"ngModelChange","ngModel"],["name","proveedor_id","required","",1,"native-select",3,"ngModelChange","ngModel"],["name","product_details","rows","3",1,"native-textarea",2,"width","100%",3,"ngModelChange","ngModel"],[1,"form-toggle-group",2,"margin-bottom","25px","text-align","center"],[2,"margin-right","5px"],["type","checkbox","name","novedad_act",1,"native-toggle",3,"ngModelChange","change","ngModel"],["name","credit_price","type","number","required","",1,"native-input",3,"ngModelChange","ngModel"],["class","form-group",4,"ngIf"],["name","brand_id","required","",1,"native-select",3,"ngModelChange","ngModel"],[1,"form-image-group",2,"text-align","center"],[1,"image-preview",2,"margin-top","10px",3,"click"],["alt","Imagen del Producto",3,"src"],[1,"form-footer"],["type","submit","color","success",1,"native-button"],["name","checkmark-outline"],[3,"value"],["name","prov_price","type","number","required","",1,"native-input",3,"ngModelChange","ngModel"],["name","max_amount","type","number","required","",1,"native-input",3,"ngModelChange","change","ngModel","value"],["name","current_amount","type","number","required","",1,"native-input",3,"ngModelChange","change","ngModel","value"]],template:function(n,r){1&n&&(e.j41(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),e.EFF(3,"Agregar Inventario"),e.k0s()()(),e.j41(4,"ion-content")(5,"div",1)(6,"h2"),e.EFF(7,"Introduce los detalles del producto"),e.k0s(),e.j41(8,"form",2),e.bIt("submit",function(){return r.saveProduct()}),e.j41(9,"ion-list",3)(10,"div",4)(11,"label",5),e.EFF(12,"Nombre del Producto"),e.k0s(),e.j41(13,"input",6),e.mxI("ngModelChange",function(a){return e.DH7(r.newProduct.name,a)||(r.newProduct.name=a),a}),e.k0s()(),e.j41(14,"div",4)(15,"label",5),e.EFF(16,"Categor\xeda"),e.k0s(),e.j41(17,"select",7),e.mxI("ngModelChange",function(a){return e.DH7(r.newProduct.category_id,a)||(r.newProduct.category_id=a),a}),e.j41(18,"option",8),e.EFF(19,"Seleccione una"),e.k0s(),e.DNE(20,F,2,2,"option",9),e.k0s()(),e.j41(21,"div",4)(22,"label",5),e.EFF(23,"Subcategor\xeda"),e.k0s(),e.j41(24,"select",10),e.mxI("ngModelChange",function(a){return e.DH7(r.newProduct.sub_category_id,a)||(r.newProduct.sub_category_id=a),a}),e.j41(25,"option",8),e.EFF(26,"Seleccione una"),e.k0s(),e.DNE(27,E,2,2,"option",9),e.k0s()(),e.j41(28,"div",4)(29,"label",5),e.EFF(30,"Proveedor"),e.k0s(),e.j41(31,"select",11),e.mxI("ngModelChange",function(a){return e.DH7(r.newProduct.proveedor_id,a)||(r.newProduct.proveedor_id=a),a}),e.j41(32,"option",8),e.EFF(33,"Seleccione un proveedor"),e.k0s(),e.DNE(34,R,2,2,"option",9),e.k0s()(),e.j41(35,"div",4)(36,"label",5),e.EFF(37,"Detalles del Producto"),e.k0s(),e.j41(38,"textarea",12),e.mxI("ngModelChange",function(a){return e.DH7(r.newProduct.product_details,a)||(r.newProduct.product_details=a),a}),e.k0s()(),e.j41(39,"div",13)(40,"label",14),e.EFF(41,"Novedad"),e.k0s(),e.j41(42,"input",15),e.mxI("ngModelChange",function(a){return e.DH7(r.newProduct.novedad_act,a)||(r.newProduct.novedad_act=a),a}),e.bIt("change",function(a){return r.toggleNovedad(a)}),e.k0s()(),e.j41(43,"div",4)(44,"label",5),e.EFF(45,"Precio de Cr\xe9dito"),e.k0s(),e.j41(46,"input",16),e.mxI("ngModelChange",function(a){return e.DH7(r.newProduct.credit_price,a)||(r.newProduct.credit_price=a),a}),e.k0s()(),e.DNE(47,j,4,3,"div",17)(48,k,4,4,"div",17)(49,x,4,4,"div",17),e.j41(50,"div",4)(51,"label",5),e.EFF(52,"Marca"),e.k0s(),e.j41(53,"select",18),e.mxI("ngModelChange",function(a){return e.DH7(r.newProduct.brand_id,a)||(r.newProduct.brand_id=a),a}),e.j41(54,"option",8),e.EFF(55,"Seleccione una"),e.k0s(),e.DNE(56,G,2,2,"option",9),e.k0s()(),e.j41(57,"div",19)(58,"label"),e.EFF(59,"Imagen del Producto"),e.k0s(),e.j41(60,"ion-avatar",20),e.bIt("click",function(){return r.presentImageOptions()}),e.nrm(61,"img",21),e.k0s()()(),e.j41(62,"div",22)(63,"button",23),e.nrm(64,"ion-icon",24),e.EFF(65," Guardar Producto "),e.k0s()()()()()),2&n&&(e.R7$(11),e.AVh("shrink",r.hasValue(r.newProduct.name)),e.R7$(2),e.R50("ngModel",r.newProduct.name),e.R7$(2),e.AVh("shrink",r.hasValue(r.newProduct.category_id)),e.R7$(2),e.R50("ngModel",r.newProduct.category_id),e.R7$(3),e.Y8G("ngForOf",r.categories),e.R7$(2),e.AVh("shrink",r.hasValue(r.newProduct.sub_category_id)),e.R7$(2),e.R50("ngModel",r.newProduct.sub_category_id),e.R7$(3),e.Y8G("ngForOf",r.subCategories),e.R7$(2),e.AVh("shrink",r.hasValue(r.newProduct.proveedor_id)),e.R7$(2),e.R50("ngModel",r.newProduct.proveedor_id),e.R7$(3),e.Y8G("ngForOf",r.providers),e.R7$(2),e.AVh("shrink",r.hasValue(r.newProduct.product_details)),e.R7$(2),e.R50("ngModel",r.newProduct.product_details),e.R7$(4),e.R50("ngModel",r.newProduct.novedad_act),e.R7$(2),e.AVh("shrink",r.hasValue(r.newProduct.credit_price)),e.R7$(2),e.R50("ngModel",r.newProduct.credit_price),e.R7$(),e.Y8G("ngIf",r.esGerente),e.R7$(),e.Y8G("ngIf",r.esGerente),e.R7$(),e.Y8G("ngIf",r.esGerente),e.R7$(2),e.AVh("shrink",r.hasValue(r.newProduct.brand_id)),e.R7$(2),e.R50("ngModel",r.newProduct.brand_id),e.R7$(3),e.Y8G("ngForOf",r.brands),e.R7$(5),e.Y8G("src",r.imageUrl||"assets/product_placeholder.png",e.B4B))},dependencies:[h.Sq,h.bT,s.qT,s.xH,s.y7,s.me,s.Q0,s.Zm,s.wz,s.BC,s.cb,s.YS,s.vS,s.cV,c.mC,c.W9,c.eU,c.iq,c.nf,c.BC,c.ai],styles:['@charset "UTF-8";.form-card[_ngcontent-%COMP%]{max-width:600px;margin:40px auto;padding:25px;border-radius:10px;background-color:#fff;box-shadow:0 4px 6px #0000001a}h2[_ngcontent-%COMP%]{text-align:center;font-size:1.6rem;color:#333;margin-bottom:30px;font-weight:700}.form-item[_ngcontent-%COMP%]{margin-bottom:20px;padding-right:15px}ion-label[_ngcontent-%COMP%]{font-weight:700;color:#666;margin-bottom:5px}ion-input[_ngcontent-%COMP%], ion-textarea[_ngcontent-%COMP%], ion-select[_ngcontent-%COMP%]{--padding-start: 12px;border:1px solid #ddd;border-radius:3px;--background: #f9f9f9}ion-select[_ngcontent-%COMP%]{--placeholder-color: #999;margin-top:5px}ion-item[_ngcontent-%COMP%]{--inner-padding-end: 0;--inner-padding-start: 0}.footer[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{border-radius:8px;font-size:1rem;font-weight:700}.title-item[_ngcontent-%COMP%]{margin-bottom:15px}.footer[_ngcontent-%COMP%]{padding:10px;display:flex;justify-content:center}.edit-footer[_ngcontent-%COMP%]{box-shadow:none;margin-top:20px}.image-preview[_ngcontent-%COMP%]{width:100px;height:100px;margin:0 auto}@media (max-width: 768px){.form-card[_ngcontent-%COMP%]{margin:0 auto}}.guardar-button[_ngcontent-%COMP%]::part(native){--background: linear-gradient(to right, #28a745, #218838);color:#fff}']}),d})()}];let T=(()=>{var t;class d{}return(t=d).\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.$C({type:t}),t.\u0275inj=e.G2t({imports:[_.iI.forChild(V),_.iI]}),d})(),D=(()=>{var t;class d{}return(t=d).\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.$C({type:t}),t.\u0275inj=e.G2t({imports:[h.MD,c.bv]}),d})(),O=(()=>{var t;class d{}return(t=d).\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.$C({type:t}),t.\u0275inj=e.G2t({imports:[h.MD,s.YN,c.bv,T,D]}),d})()}}]);