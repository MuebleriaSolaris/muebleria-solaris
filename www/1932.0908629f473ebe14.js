"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1932],{1932:($,h,d)=>{d.r(h),d.d(h,{ProductoPageModule:()=>O});var s=d(177),p=d(4341),a=d(4742),g=d(1671),m=d(467),t=d(4438),f=d(4934),P=d(1626),b=d(4796);const u=e=>({"font-weight":e});function M(e,c){if(1&e){const n=t.RV6();t.j41(0,"ion-input",26),t.mxI("ngModelChange",function(o){t.eBV(n);const r=t.XpG(2);return t.DH7(r.product.name,o)||(r.product.name=o),t.Njj(o)}),t.k0s()}if(2&e){const n=t.XpG(2);t.R50("ngModel",n.product.name)}}function v(e,c){if(1&e&&(t.j41(0,"ion-item"),t.nrm(1,"ion-icon",24),t.j41(2,"ion-label")(3,"h2",15),t.EFF(4,"Nombre"),t.k0s(),t.DNE(5,M,1,1,"ion-input",25),t.k0s()()),2&e){const n=t.XpG();t.R7$(3),t.Y8G("ngStyle",t.eq3(2,u,n.isEditMode?"bold":"normal")),t.R7$(2),t.Y8G("ngIf",n.isEditMode)}}function x(e,c){if(1&e&&(t.j41(0,"p"),t.EFF(1),t.nI1(2,"number"),t.k0s()),2&e){const n=t.XpG();t.R7$(),t.SpI("$ ",t.i5U(2,1,null==n.product?null:n.product.credit_price,"1.2-2"),"")}}function E(e,c){if(1&e){const n=t.RV6();t.j41(0,"ion-input",27),t.mxI("ngModelChange",function(o){t.eBV(n);const r=t.XpG();return t.DH7(r.product.credit_price,o)||(r.product.credit_price=o),t.Njj(o)}),t.bIt("ionInput",function(o){t.eBV(n);const r=t.XpG();return t.Njj(r.validateCreditPriceInput(o))}),t.k0s()}if(2&e){const n=t.XpG();t.R50("ngModel",n.product.credit_price)}}function k(e,c){if(1&e&&(t.j41(0,"p"),t.EFF(1),t.k0s()),2&e){const n=t.XpG(2);t.R7$(),t.SpI("$ ",null==n.product?null:n.product.prov_price,"")}}function I(e,c){if(1&e){const n=t.RV6();t.j41(0,"ion-input",29),t.mxI("ngModelChange",function(o){t.eBV(n);const r=t.XpG(2);return t.DH7(r.product.prov_price,o)||(r.product.prov_price=o),t.Njj(o)}),t.bIt("ionInput",function(o){t.eBV(n);const r=t.XpG(2);return t.Njj(r.validateProvPriceInput(o))}),t.k0s()}if(2&e){const n=t.XpG(2);t.R50("ngModel",n.product.prov_price)}}function C(e,c){if(1&e&&(t.j41(0,"ion-item"),t.nrm(1,"ion-icon",14),t.j41(2,"ion-label")(3,"h2",15),t.EFF(4,"Precio Provedor"),t.k0s(),t.DNE(5,k,2,1,"p",13)(6,I,1,1,"ion-input",28),t.k0s()()),2&e){const n=t.XpG();t.R7$(3),t.Y8G("ngStyle",t.eq3(3,u,n.isEditMode?"bold":"normal")),t.R7$(2),t.Y8G("ngIf",!n.isEditMode),t.R7$(),t.Y8G("ngIf",n.isEditMode)}}function j(e,c){if(1&e&&(t.j41(0,"p"),t.EFF(1),t.k0s()),2&e){const n=t.XpG();t.R7$(),t.JRh(null==n.product?null:n.product.current_stock)}}function G(e,c){if(1&e){const n=t.RV6();t.j41(0,"ion-input",30),t.mxI("ngModelChange",function(o){t.eBV(n);const r=t.XpG();return t.DH7(r.product.current_stock,o)||(r.product.current_stock=o),t.Njj(o)}),t.bIt("ionInput",function(o){t.eBV(n);const r=t.XpG();return t.Njj(r.validateStockInput(o))}),t.k0s()}if(2&e){const n=t.XpG();t.R50("ngModel",n.product.current_stock)}}function F(e,c){if(1&e&&(t.j41(0,"p"),t.EFF(1),t.k0s()),2&e){const n=t.XpG();t.R7$(),t.JRh(null==n.product?null:n.product.max_amount)}}function R(e,c){if(1&e){const n=t.RV6();t.j41(0,"ion-input",30),t.mxI("ngModelChange",function(o){t.eBV(n);const r=t.XpG();return t.DH7(r.product.max_amount,o)||(r.product.max_amount=o),t.Njj(o)}),t.bIt("ionInput",function(o){t.eBV(n);const r=t.XpG();return t.Njj(r.validateStockInput(o))}),t.k0s()}if(2&e){const n=t.XpG();t.R50("ngModel",n.product.max_amount)}}function y(e,c){if(1&e&&(t.j41(0,"p"),t.EFF(1),t.k0s()),2&e){const n=t.XpG();t.R7$(),t.JRh(null==n.product?null:n.product.provider_name)}}function T(e,c){if(1&e&&(t.j41(0,"ion-select-option",33),t.EFF(1),t.k0s()),2&e){const n=c.$implicit;t.Y8G("value",n.id),t.R7$(),t.SpI(" ",n.name," ")}}function S(e,c){if(1&e){const n=t.RV6();t.j41(0,"ion-select",31),t.mxI("ngModelChange",function(o){t.eBV(n);const r=t.XpG();return t.DH7(r.product.provider_id,o)||(r.product.provider_id=o),t.Njj(o)}),t.DNE(1,T,2,2,"ion-select-option",32),t.k0s()}if(2&e){const n=t.XpG();t.R50("ngModel",n.product.provider_id),t.R7$(),t.Y8G("ngForOf",n.providers)}}function X(e,c){if(1&e){const n=t.RV6();t.j41(0,"ion-footer",34)(1,"div",35)(2,"ion-button",36),t.bIt("click",function(){t.eBV(n);const o=t.XpG();return t.Njj(o.saveChanges())}),t.nrm(3,"ion-icon",37),t.EFF(4," Guardar "),t.k0s(),t.j41(5,"ion-button",38),t.bIt("click",function(){t.eBV(n);const o=t.XpG();return t.Njj(o.cancelEdit())}),t.nrm(6,"ion-icon",39),t.EFF(7," Cancelar "),t.k0s()()()}}const D=[{path:"",component:(()=>{var e;class c{constructor(i,o,r,l,_){this.route=i,this.inventoryService=o,this.alertController=r,this.http=l,this.authService=_,this.providers=[],this.isEditMode=!1,this.esGerente=!1}ngOnInit(){const i=this.authService.getUserId();i&&this.http.get(`https://muebleriasolaris.com/ionic-login/check_gerencia.php?userid=${i}`).subscribe(r=>{r.success?this.esGerente=r.isGerente:console.error("Error en la respuesta de la API:",r.error),console.log("\xbfEs gerente?",this.esGerente),console.log("ID de usuario:",i)},r=>{console.error("Error en la llamada HTTP:",r)});const o=+this.route.snapshot.paramMap.get("id");this.fetchProduct(o),this.fetchProviders()}fetchProduct(i){this.inventoryService.getProducts().subscribe(o=>{o.success&&(this.product=o.data.find(r=>r.product_id===i),this.originalProduct={...this.product})},o=>{console.error("Error al obtener el producto:",o)})}fetchProviders(){this.inventoryService.getProviders().subscribe(i=>{i.success&&(this.providers=i.data)},i=>{console.error("Error al obtener los proveedores:",i)})}toggleEditMode(){this.isEditMode?this.product={...this.originalProduct}:this.product.updated_at=(new Date).toLocaleString(),this.isEditMode=!this.isEditMode}confirmSaveChanges(){var i=this;return(0,m.A)(function*(){yield(yield i.alertController.create({header:"Confirmar Actualizaci\xf3n",message:"\xbfEst\xe1s seguro de que deseas actualizar este producto?",buttons:[{text:"Cancelar",role:"cancel",cssClass:"secondary"},{text:"Actualizar",handler:()=>{i.saveChanges()}}]})).present()})()}saveChanges(){this.product&&this.product.product_id?(this.product.name=this.product.name,this.product.credit_price=parseFloat(this.product.credit_price),this.product.prov_price=parseFloat(this.product.prov_price),this.product.current_stock=parseInt(this.product.current_stock,10),this.product.max_amount=parseInt(this.product.max_amount,10),console.log("Datos enviados al backend:",this.product),this.inventoryService.saveProduct(this.product).subscribe({next:i=>{i.success?(this.showAlert("\xc9xito","Producto actualizado correctamente."),this.originalProduct={...this.product},this.isEditMode=!1,window.location.reload()):this.showAlert("Error","Error al actualizar el producto: "+i.message)},error:i=>{console.error("Error al actualizar el producto:",i),this.showAlert("Error","Ocurri\xf3 un error al actualizar el producto.")}})):console.error("El producto no tiene un ID v\xe1lido.")}confirmDelete(){var i=this;return(0,m.A)(function*(){yield(yield i.alertController.create({header:"Confirmar Eliminaci\xf3n",message:"\xbfEst\xe1s seguro de que deseas eliminar este producto?",buttons:[{text:"Cancelar",role:"cancel",cssClass:"secondary"},{text:"Eliminar",handler:()=>{i.deleteProduct()}}]})).present()})()}deleteProduct(){this.product&&this.product.product_id?this.inventoryService.deleteProduct(this.product.product_id).subscribe({next:i=>{i.success?(this.showAlert("\xc9xito","Producto eliminado correctamente."),this.goBack()):this.showAlert("Error","Error al eliminar el producto: "+i.message)},error:i=>{console.error("Error al eliminar el producto:",i),this.showAlert("Error","Ocurri\xf3 un error al eliminar el producto.")}}):console.error("El producto no tiene un ID v\xe1lido.")}showAlert(i,o,r=3e3){var l=this;return(0,m.A)(function*(){const _=yield l.alertController.create({header:i,message:o,buttons:["OK"]});yield _.present(),setTimeout(()=>{_.dismiss()},r)})()}cancelEdit(){console.log("Cancelando edici\xf3n"),this.product={...this.originalProduct},this.isEditMode=!1}goBack(){window.history.back()}validateStockInput(i){let o=i.target.value;o=o.replace(/[^0-9]/g,""),o.length>5&&(o=o.slice(0,5)),i.target.value=o,this.product.current_stock=o}validateCreditPriceInput(i){var o;let r=i.target.value;r=r.replace(/[^0-9.]/g,"");const l=r.split(".");l.length>2&&(r=l[0]+"."+l[1]),(null===(o=l[1])||void 0===o?void 0:o.length)>2&&(r=l[0]+"."+l[1].substring(0,2)),i.target.value=r,this.product.credit_price=r}validateProvPriceInput(i){var o;let r=i.target.value;r=r.replace(/[^0-9.]/g,"");const l=r.split(".");l.length>2&&(r=l[0]+"."+l[1]),(null===(o=l[1])||void 0===o?void 0:o.length)>2&&(r=l[0]+"."+l[1].substring(0,2)),i.target.value=r,this.product.prov_price=r}}return(e=c).\u0275fac=function(i){return new(i||e)(t.rXU(g.nX),t.rXU(f.c),t.rXU(a.hG),t.rXU(P.Qq),t.rXU(b.u))},e.\u0275cmp=t.VBU({type:e,selectors:[["app-producto"]],decls:65,vars:29,consts:[[1,"profile-header"],[1,"profile-avatar"],["src","assets/product_placeholder.png","alt","Imagen del Producto"],[1,"top-button-container"],["color","light",1,"regresar-button",3,"click"],["name","arrow-back-outline","slot","start"],["color","secondary",3,"click"],["name","create-outline","slot","start"],["color","danger",3,"click"],["name","trash-outline","slot","start"],[1,"account-info"],[1,"top-cliente"],["lines","none"],[4,"ngIf"],["name","pricetag-outline","slot","start"],[3,"ngStyle"],["placeholder","Precio Cr\xe9dito","type","text","inputmode","decimal",3,"ngModel","ngModelChange","ionInput",4,"ngIf"],["name","layers-outline","slot","start"],["placeholder","Stock","type","tel","inputmode","numeric",3,"ngModel","ngModelChange","ionInput",4,"ngIf"],["name","analytics-outline","slot","start"],["name","business-outline","slot","start"],["placeholder","Seleccionar Proveedor",3,"ngModel","ngModelChange",4,"ngIf"],["name","time-outline","slot","start"],["class","edit-footer",4,"ngIf"],["name","person-outline","slot","start"],["name","name","placeholder","Nuevo Nombre","type","text","required","",3,"ngModel","ngModelChange",4,"ngIf"],["name","name","placeholder","Nuevo Nombre","type","text","required","",3,"ngModelChange","ngModel"],["placeholder","Precio Cr\xe9dito","type","text","inputmode","decimal",3,"ngModelChange","ionInput","ngModel"],["placeholder","Precio Provedor","type","text","inputmode","decimal",3,"ngModel","ngModelChange","ionInput",4,"ngIf"],["placeholder","Precio Provedor","type","text","inputmode","decimal",3,"ngModelChange","ionInput","ngModel"],["placeholder","Stock","type","tel","inputmode","numeric",3,"ngModelChange","ionInput","ngModel"],["placeholder","Seleccionar Proveedor",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"edit-footer"],[1,"bottom-action-buttons"],["expand","block","color","success",1,"guardar-button",3,"click"],["slot","start","name","checkmark-outline"],["expand","block","color","danger",1,"cancelar-button",3,"click"],["slot","start","name","close-outline"]],template:function(i,o){1&i&&(t.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),t.EFF(3,"Detalles del Producto"),t.k0s()()(),t.j41(4,"ion-content")(5,"div",0)(6,"ion-avatar",1),t.nrm(7,"img",2),t.k0s(),t.j41(8,"h2"),t.EFF(9),t.k0s(),t.j41(10,"p"),t.EFF(11),t.k0s()(),t.j41(12,"div",3)(13,"ion-button",4),t.bIt("click",function(){return o.goBack()}),t.nrm(14,"ion-icon",5),t.EFF(15," Regresar "),t.k0s(),t.j41(16,"ion-button",6),t.bIt("click",function(){return o.toggleEditMode()}),t.nrm(17,"ion-icon",7),t.EFF(18," Editar "),t.k0s(),t.j41(19,"ion-button",8),t.bIt("click",function(){return o.confirmDelete()}),t.nrm(20,"ion-icon",9),t.EFF(21," Eliminar "),t.k0s()(),t.j41(22,"div",10)(23,"div",11)(24,"h3"),t.EFF(25,"Detalles del Producto"),t.k0s()(),t.j41(26,"ion-list",12),t.DNE(27,v,6,4,"ion-item",13),t.j41(28,"ion-item"),t.nrm(29,"ion-icon",14),t.j41(30,"ion-label")(31,"h2",15),t.EFF(32,"Precio Cr\xe9dito"),t.k0s(),t.DNE(33,x,3,4,"p",13)(34,E,1,1,"ion-input",16),t.k0s()(),t.DNE(35,C,7,5,"ion-item",13),t.j41(36,"ion-item"),t.nrm(37,"ion-icon",17),t.j41(38,"ion-label")(39,"h2",15),t.EFF(40,"Stock Disponible"),t.k0s(),t.DNE(41,j,2,1,"p",13)(42,G,1,1,"ion-input",18),t.k0s()(),t.j41(43,"ion-item"),t.nrm(44,"ion-icon",19),t.j41(45,"ion-label")(46,"h2",15),t.EFF(47,"Max Stock"),t.k0s(),t.DNE(48,F,2,1,"p",13)(49,R,1,1,"ion-input",18),t.k0s()(),t.j41(50,"ion-item"),t.nrm(51,"ion-icon",20),t.j41(52,"ion-label")(53,"h2",15),t.EFF(54,"Proveedor"),t.k0s(),t.DNE(55,y,2,1,"p",13)(56,S,2,2,"ion-select",21),t.k0s()(),t.j41(57,"ion-item"),t.nrm(58,"ion-icon",22),t.j41(59,"ion-label")(60,"h2",15),t.EFF(61,"\xdaltima Actualizaci\xf3n"),t.k0s(),t.j41(62,"p"),t.EFF(63),t.k0s()()()(),t.DNE(64,X,8,0,"ion-footer",23),t.k0s()()),2&i&&(t.R7$(9),t.JRh(null==o.product?null:o.product.product_name),t.R7$(2),t.SpI("ID: ",null==o.product?null:o.product.product_id,""),t.R7$(16),t.Y8G("ngIf",o.isEditMode),t.R7$(4),t.Y8G("ngStyle",t.eq3(19,u,o.isEditMode?"bold":"normal")),t.R7$(2),t.Y8G("ngIf",!o.isEditMode),t.R7$(),t.Y8G("ngIf",o.isEditMode),t.R7$(),t.Y8G("ngIf",o.esGerente),t.R7$(4),t.Y8G("ngStyle",t.eq3(21,u,o.isEditMode?"bold":"normal")),t.R7$(2),t.Y8G("ngIf",!o.isEditMode),t.R7$(),t.Y8G("ngIf",o.isEditMode),t.R7$(4),t.Y8G("ngStyle",t.eq3(23,u,o.isEditMode?"bold":"normal")),t.R7$(2),t.Y8G("ngIf",!o.isEditMode),t.R7$(),t.Y8G("ngIf",o.isEditMode),t.R7$(4),t.Y8G("ngStyle",t.eq3(25,u,o.isEditMode?"bold":"normal")),t.R7$(2),t.Y8G("ngIf",!o.isEditMode),t.R7$(),t.Y8G("ngIf",o.isEditMode),t.R7$(4),t.Y8G("ngStyle",t.eq3(27,u,o.isEditMode?"bold":"normal")),t.R7$(3),t.JRh(null==o.product?null:o.product.updated_at),t.R7$(),t.Y8G("ngIf",o.isEditMode))},dependencies:[s.Sq,s.bT,s.B3,p.BC,p.YS,p.vS,a.mC,a.Jm,a.W9,a.M0,a.eU,a.iq,a.$w,a.uz,a.he,a.nf,a.Nm,a.Ip,a.BC,a.ai,a.Je,a.Gw,s.QX],styles:["ion-content[_ngcontent-%COMP%]{--background: #f7f7f7}.profile-header[_ngcontent-%COMP%]{text-align:center;padding:50px 20px;background:linear-gradient(to bottom,#3880ff,#dfdfdf);color:#fff;border-bottom-left-radius:20px;border-bottom-right-radius:20px;display:flex;flex-direction:column;align-items:center;justify-content:center;max-width:800px;margin:0 auto}.profile-avatar[_ngcontent-%COMP%]{width:120px;height:120px;margin-bottom:10px;border-radius:50%;overflow:hidden;border:3px solid white;background-color:#fff}.top-button-container[_ngcontent-%COMP%]{display:flex;justify-content:space-around;gap:20px;padding:10px 0;background:#3880ff;border-bottom-left-radius:20px;border-bottom-right-radius:20px;max-width:800px;margin:-20px auto 0}.top-button-container[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{width:auto;font-size:.9rem}.regresar-button[_ngcontent-%COMP%]::part(native){background-color:#fff!important;color:#2f4f4f}.account-info[_ngcontent-%COMP%]{padding:30px;margin:30px auto;background:#fff;border-radius:15px;box-shadow:0 4px 8px #0000001a;max-width:700px;text-align:left}ion-list[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.1rem;color:#333;margin-bottom:5px}ion-list[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:4px;font-size:.9rem;color:#666}.bottom-action-buttons[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:20px 0 0;margin:0 auto;max-width:700px}.bottom-action-buttons[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{flex:1;margin:0 10px;font-weight:700;color:#fff;--border-radius: 8px;--padding: 10px 0}.guardar-button[_ngcontent-%COMP%]::part(native){--background: linear-gradient(to right, #28a745, #218838);color:#fff}.cancelar-button[_ngcontent-%COMP%]::part(native){--background: linear-gradient(to right, #dc3545, #c82333)}@media (min-width: 768px){.profile-header[_ngcontent-%COMP%], .account-info[_ngcontent-%COMP%], .top-button-container[_ngcontent-%COMP%]{max-width:800px;margin:0 auto}.top-button-container[_ngcontent-%COMP%]{margin-top:-15px}}.edit-footer[_ngcontent-%COMP%]{box-shadow:none}"]}),c})()}];let N=(()=>{var e;class c{}return(e=c).\u0275fac=function(i){return new(i||e)},e.\u0275mod=t.$C({type:e}),e.\u0275inj=t.G2t({imports:[g.iI.forChild(D),g.iI]}),c})(),O=(()=>{var e;class c{}return(e=c).\u0275fac=function(i){return new(i||e)},e.\u0275mod=t.$C({type:e}),e.\u0275inj=t.G2t({imports:[s.MD,p.YN,a.bv,N]}),c})()}}]);