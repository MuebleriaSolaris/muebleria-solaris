"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4029],{4029:(G,b,c)=>{c.r(b),c.d(b,{AgregarInventarioPageModule:()=>D});var _=c(177),m=c(4341),i=c(7125),f=c(1671),g=c(467),P=c(3114),I=c(2704),e=c(4438),C=c(4934),M=c(3656),y=c(1626),w=c(4796);function A(n,d){if(1&n&&(e.j41(0,"ion-select-option",22),e.EFF(1),e.k0s()),2&n){const a=d.$implicit;e.Y8G("value",a.id),e.R7$(),e.JRh(a.name)}}function E(n,d){if(1&n&&(e.j41(0,"ion-select-option",22),e.EFF(1),e.k0s()),2&n){const a=d.$implicit;e.Y8G("value",a.id),e.R7$(),e.JRh(a.name)}}function F(n,d){if(1&n&&(e.j41(0,"ion-select-option",22),e.EFF(1),e.k0s()),2&n){const a=d.$implicit;e.Y8G("value",a.id),e.R7$(),e.JRh(a.name)}}function R(n,d){if(1&n){const a=e.RV6();e.j41(0,"ion-item",4)(1,"ion-label",5),e.EFF(2,"Precio de Provedor"),e.k0s(),e.j41(3,"ion-input",23),e.mxI("ngModelChange",function(o){e.eBV(a);const l=e.XpG();return e.DH7(l.newProduct.prov_price,o)||(l.newProduct.prov_price=o),e.Njj(o)}),e.k0s()()}if(2&n){const a=e.XpG();e.R7$(3),e.R50("ngModel",a.newProduct.prov_price)}}function x(n,d){if(1&n&&(e.j41(0,"ion-select-option",22),e.EFF(1),e.k0s()),2&n){const a=d.$implicit;e.Y8G("value",a.id),e.R7$(),e.JRh(a.name)}}const j=[{path:"",component:(()=>{var n;class d{constructor(r,o,l,t,u,s,p,h){this.inventoryService=r,this.navCtrl=o,this.alertController=l,this.router=t,this.http=u,this.authService=s,this.actionSheetController=p,this.modalController=h,this.newProduct={name:"",category_id:null,sub_category_id:null,product_details:"",novedad_act:0,credit_price:null,brand_id:null,proveedor_id:null,prov_price:null},this.categories=[],this.subCategories=[],this.brands=[],this.providers=[],this.nextProductId=null,this.selectedImage=null,this.esGerente=!1,this.imageUrl=null}ngOnInit(){const r=this.authService.getUserId();r&&this.http.get(`https://muebleriasolaris.com/ionic-login/check_gerencia.php?userid=${r}`).subscribe(o=>{o.success?this.esGerente=o.isGerente:console.error("Error en la respuesta de la API:",o.error),console.log("\xbfEs gerente?",this.esGerente),console.log("ID de usuario:",r)},o=>{console.error("Error en la llamada HTTP:",o)}),this.loadCategories(),this.loadBrands(),this.loadSubCategories(),this.loadprovider()}getNextProductId(){var r=this;return(0,g.A)(function*(){try{const o=yield r.http.get("https://muebleriasolaris.com/ionic-products/get_next_product_id.php").toPromise();if("success"!==o.status)throw new Error(o.message);r.nextProductId=o.next_id}catch(o){console.error("Error al obtener el siguiente ID:",o),yield r.showAlert("Error","No se pudo obtener el siguiente ID del producto.")}})()}viewImage(){var r=this;return(0,g.A)(function*(){r.imageUrl?yield(yield r.modalController.create({component:I.d,componentProps:{imageUrl:r.imageUrl}})).present():yield r.showAlert("Error","No hay imagen para mostrar.")})()}uploadImage(r){var o=this;return(0,g.A)(function*(){if(!o.nextProductId)return void(yield o.showAlert("Error","No se ha obtenido un ID v\xe1lido para el producto."));const t=yield(yield fetch(r)).blob(),u=new FormData;u.append("image",t,`product_${o.nextProductId}.jpg`),u.append("product_id",o.nextProductId.toString()),o.http.post("https://muebleriasolaris.com/ionic-products/ftp_image_upload.php",u).subscribe({next:s=>{console.log("Respuesta del servidor:",s),"success"===s.status?(o.selectedImage=s.image_url,o.imageUrl=s.image_url,console.log("Imagen subida correctamente:",o.imageUrl),o.showAlert("\xc9xito","Imagen subida correctamente.")):o.showAlert("Error",s.message||"No se pudo subir la imagen.")},error:s=>{console.error("Error al subir la imagen:",s),o.showAlert("Error","Ocurri\xf3 un error al subir la imagen.")}})})()}deleteImage(){var r=this;return(0,g.A)(function*(){r.imageUrl="assets/product_placeholder.png",r.selectedImage="assets/product_placeholder.png",r.showAlert("\xc9xito","Imagen eliminada correctamente.")})()}changeImage(){var r=this;return(0,g.A)(function*(){try{const o=yield P.i7.getPhoto({quality:90,allowEditing:!1,resultType:P.LK.Uri,source:P.ru.Photos});o.webPath&&(yield r.getNextProductId(),yield r.uploadImage(o.webPath))}catch(o){console.error("Error al seleccionar la imagen:",o)}})()}presentImageOptions(){var r=this;return(0,g.A)(function*(){console.log("Click en Imagen"),yield(yield r.actionSheetController.create({header:"Opciones de imagen",buttons:[{text:"Cambiar imagen",icon:"image",handler:()=>{r.changeImage()}},{text:"Eliminar imagen",icon:"trash",handler:()=>{r.deleteImage()}},{text:"Ver imagen",icon:"eye-outline",handler:()=>{r.viewImage()}},{text:"Cancelar",icon:"close",role:"cancel"}]})).present()})()}showAlert(r,o){var l=this;return(0,g.A)(function*(){yield(yield l.alertController.create({header:r,message:o,buttons:["OK"]})).present()})()}loadCategories(){var r=this;this.inventoryService.getCategories().subscribe(o=>{o.success&&(this.categories=o.data)},function(){var o=(0,g.A)(function*(l){console.error("Error al cargar categor\xedas:",l),yield r.showAlert("Error","No se pudieron cargar las categor\xedas")});return function(l){return o.apply(this,arguments)}}())}loadSubCategories(){this.inventoryService.getSubCategories().subscribe(r=>{r.success&&(this.subCategories=r.data)},r=>{console.error("Error al cargar categor\xedas:",r)})}loadBrands(){this.inventoryService.getBrands().subscribe(r=>{r.success&&(this.brands=r.data)},r=>{console.error("Error al cargar marcas:",r)})}loadprovider(){this.inventoryService.getProviders().subscribe(r=>{r.success&&(this.providers=r.data)},r=>{console.error("Error al cargar proveedores:",r)})}resetForm(){this.newProduct={name:"",category_id:null,sub_category_id:null,product_details:"",novedad_act:0,credit_price:null,brand_id:null,proveedor_id:null}}toggleNovedad(r){this.newProduct.novedad_act=r.detail.checked?1:0}saveProduct(){var r=this;return(0,g.A)(function*(){const{name:o}=r.newProduct;if(!o)return void(yield r.showAlert("Campo obligatorio","Por favor, ingresa el nombre del producto."));const l={name:r.newProduct.name,category_id:r.newProduct.category_id||14,sub_category_id:r.newProduct.sub_category_id||31,brand_id:r.newProduct.brand_id||1,credit_price:r.newProduct.credit_price||0,proveedor_id:r.newProduct.proveedor_id||10,product_details:r.newProduct.product_details||"",novedad_act:r.newProduct.novedad_act?1:0,prov_price:r.newProduct.prov_price||0,image_url:r.imageUrl};yield(yield r.alertController.create({header:"Confirmar",message:"\xbfEst\xe1s seguro de que deseas guardar este producto?",buttons:[{text:"Cancelar",role:"cancel"},{text:"Guardar",handler:()=>{var u;r.inventoryService.addInventory(l).subscribe({next:(u=(0,g.A)(function*(s){s.success&&(yield r.showAlert("\xc9xito","Producto agregado correctamente"),r.router.navigate(["/inventario"],{state:{componentRef:r}}).then(()=>{var p;const h=r.router.getCurrentNavigation(),v=null==h||null===(p=h.extras)||void 0===p?void 0:p.state;null!=v&&v.componentRef&&v.componentRef.instance.ngOnInit()}))}),function(p){return u.apply(this,arguments)}),error:function(){var u=(0,g.A)(function*(s){console.error("Error:",s),yield r.showAlert("Error","Error en el servidor")});return function(p){return u.apply(this,arguments)}}(),complete:()=>{console.log("Operaci\xf3n completada")}})}}]})).present()})()}}return(n=d).\u0275fac=function(r){return new(r||n)(e.rXU(C.c),e.rXU(M.q9),e.rXU(i.hG),e.rXU(f.Ix),e.rXU(y.Qq),e.rXU(w.u),e.rXU(i.GD),e.rXU(i.W3))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-agregar-inventario"]],decls:56,vars:14,consts:[["color","primary"],[1,"form-card"],[3,"submit"],["lines","none"],[1,"form-item"],["position","stacked",1,"title-item"],["name","name","required","",3,"ngModelChange","ngModel"],[1,"image-preview",3,"click"],["alt","Imagen del Producto",3,"src"],["name","category_id","placeholder","Seleccione una","required","",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["name","sub_category_id","placeholder","Seleccione una","required","",3,"ngModelChange","ngModel"],["name","proveedor_id","placeholder","Seleccione un proveedor","required","",3,"ngModelChange","ngModel"],["name","product_details",3,"ngModelChange","ngModel"],[1,"title-item"],["name","novedad_act",3,"ngModelChange","ionChange","ngModel"],["name","credit_price","type","number","required","",3,"ngModelChange","ngModel"],["class","form-item",4,"ngIf"],["name","brand_id","placeholder","Seleccione una","required","",3,"ngModelChange","ngModel"],[1,"footer","edit-footer"],["expand","block","color","primary","type","submit"],["slot","start","name","checkmark-outline"],[3,"value"],["name","prov_price","type","number","required","",3,"ngModelChange","ngModel"]],template:function(r,o){1&r&&(e.j41(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),e.EFF(3,"Agregar Inventario"),e.k0s()()(),e.j41(4,"ion-content")(5,"div",1)(6,"h2"),e.EFF(7,"Introduce los detalles del producto"),e.k0s(),e.j41(8,"form",2),e.bIt("submit",function(){return o.saveProduct()}),e.j41(9,"ion-list",3)(10,"ion-item",4)(11,"ion-label",5),e.EFF(12,"Nombre del Producto"),e.k0s(),e.j41(13,"ion-input",6),e.mxI("ngModelChange",function(t){return e.DH7(o.newProduct.name,t)||(o.newProduct.name=t),t}),e.k0s()(),e.j41(14,"ion-item",4)(15,"ion-label",5),e.EFF(16,"Imagen del Producto"),e.k0s(),e.j41(17,"ion-avatar",7),e.bIt("click",function(){return o.presentImageOptions()}),e.nrm(18,"img",8),e.k0s()(),e.j41(19,"ion-item",4)(20,"ion-label",5),e.EFF(21,"Categor\xeda"),e.k0s(),e.j41(22,"ion-select",9),e.mxI("ngModelChange",function(t){return e.DH7(o.newProduct.category_id,t)||(o.newProduct.category_id=t),t}),e.DNE(23,A,2,2,"ion-select-option",10),e.k0s()(),e.j41(24,"ion-item",4)(25,"ion-label",5),e.EFF(26,"Subcategor\xeda"),e.k0s(),e.j41(27,"ion-select",11),e.mxI("ngModelChange",function(t){return e.DH7(o.newProduct.sub_category_id,t)||(o.newProduct.sub_category_id=t),t}),e.DNE(28,E,2,2,"ion-select-option",10),e.k0s()(),e.j41(29,"ion-item",4)(30,"ion-label",5),e.EFF(31,"Proveedor"),e.k0s(),e.j41(32,"ion-select",12),e.mxI("ngModelChange",function(t){return e.DH7(o.newProduct.proveedor_id,t)||(o.newProduct.proveedor_id=t),t}),e.DNE(33,F,2,2,"ion-select-option",10),e.k0s()(),e.j41(34,"ion-item",4)(35,"ion-label",5),e.EFF(36,"Detalles del Producto"),e.k0s(),e.j41(37,"ion-textarea",13),e.mxI("ngModelChange",function(t){return e.DH7(o.newProduct.product_details,t)||(o.newProduct.product_details=t),t}),e.k0s()(),e.j41(38,"ion-item",4)(39,"ion-label",14),e.EFF(40,"Novedad"),e.k0s(),e.j41(41,"ion-toggle",15),e.mxI("ngModelChange",function(t){return e.DH7(o.newProduct.novedad_act,t)||(o.newProduct.novedad_act=t),t}),e.bIt("ionChange",function(t){return o.toggleNovedad(t)}),e.k0s()(),e.j41(42,"ion-item",4)(43,"ion-label",5),e.EFF(44,"Precio de Cr\xe9dito"),e.k0s(),e.j41(45,"ion-input",16),e.mxI("ngModelChange",function(t){return e.DH7(o.newProduct.credit_price,t)||(o.newProduct.credit_price=t),t}),e.k0s()(),e.DNE(46,R,4,1,"ion-item",17),e.j41(47,"ion-item",4)(48,"ion-label",5),e.EFF(49,"Marca"),e.k0s(),e.j41(50,"ion-select",18),e.mxI("ngModelChange",function(t){return e.DH7(o.newProduct.brand_id,t)||(o.newProduct.brand_id=t),t}),e.DNE(51,x,2,2,"ion-select-option",10),e.k0s()()(),e.j41(52,"ion-footer",19)(53,"ion-button",20),e.nrm(54,"ion-icon",21),e.EFF(55," Guardar Producto "),e.k0s()()()()()),2&r&&(e.R7$(13),e.R50("ngModel",o.newProduct.name),e.R7$(5),e.Y8G("src",o.imageUrl||"assets/product_placeholder.png",e.B4B),e.R7$(4),e.R50("ngModel",o.newProduct.category_id),e.R7$(),e.Y8G("ngForOf",o.categories),e.R7$(4),e.R50("ngModel",o.newProduct.sub_category_id),e.R7$(),e.Y8G("ngForOf",o.subCategories),e.R7$(4),e.R50("ngModel",o.newProduct.proveedor_id),e.R7$(),e.Y8G("ngForOf",o.providers),e.R7$(4),e.R50("ngModel",o.newProduct.product_details),e.R7$(4),e.R50("ngModel",o.newProduct.novedad_act),e.R7$(4),e.R50("ngModel",o.newProduct.credit_price),e.R7$(),e.Y8G("ngIf",o.esGerente),e.R7$(4),e.R50("ngModel",o.newProduct.brand_id),e.R7$(),e.Y8G("ngForOf",o.brands))},dependencies:[_.Sq,_.bT,m.qT,m.BC,m.cb,m.YS,m.vS,m.cV,i.mC,i.Jm,i.W9,i.M0,i.eU,i.iq,i.$w,i.uz,i.he,i.nf,i.Nm,i.Ip,i.nc,i.BC,i.BY,i.ai,i.hB,i.su,i.Je,i.Gw],styles:['@charset "UTF-8";.form-card[_ngcontent-%COMP%]{max-width:600px;margin:40px auto;padding:25px;border-radius:10px;background-color:#fff;box-shadow:0 4px 6px #0000001a}h2[_ngcontent-%COMP%]{text-align:center;font-size:1.6rem;color:#333;margin-bottom:30px;font-weight:700}.form-item[_ngcontent-%COMP%]{margin-bottom:20px;padding-right:15px}ion-label[_ngcontent-%COMP%]{font-weight:700;color:#666;margin-bottom:5px}ion-input[_ngcontent-%COMP%], ion-textarea[_ngcontent-%COMP%], ion-select[_ngcontent-%COMP%]{--padding-start: 12px;border:1px solid #ddd;border-radius:3px;--background: #f9f9f9}ion-select[_ngcontent-%COMP%]{--placeholder-color: #999;margin-top:5px}ion-item[_ngcontent-%COMP%]{--inner-padding-end: 0;--inner-padding-start: 0}.footer[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{border-radius:8px;font-size:1rem;font-weight:700}.title-item[_ngcontent-%COMP%]{margin-bottom:15px}.footer[_ngcontent-%COMP%]{padding:10px;display:flex;justify-content:center}.edit-footer[_ngcontent-%COMP%]{box-shadow:none;margin-top:20px}.image-preview[_ngcontent-%COMP%]{width:100px;height:100px;margin:0 auto}@media (max-width: 768px){.form-card[_ngcontent-%COMP%]{margin:0 auto}}']}),d})()}];let k=(()=>{var n;class d{}return(n=d).\u0275fac=function(r){return new(r||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[f.iI.forChild(j),f.iI]}),d})(),O=(()=>{var n;class d{}return(n=d).\u0275fac=function(r){return new(r||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[_.MD,i.bv]}),d})(),D=(()=>{var n;class d{}return(n=d).\u0275fac=function(r){return new(r||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[_.MD,m.YN,i.bv,k,O]}),d})()}}]);