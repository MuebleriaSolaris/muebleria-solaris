"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9394],{9394:(C,m,u)=>{u.r(m),u.d(m,{InventarioPageModule:()=>$});var _=u(177),h=u(4341),a=u(7125),d=u(1671),t=u(4438),f=u(4934),s=u(4796),p=u(4191);function v(r,c){if(1&r&&(t.j41(0,"ion-select-option",9),t.EFF(1),t.k0s()),2&r){const o=c.$implicit;t.Y8G("value",o.id),t.R7$(),t.SpI(" ",o.name," ")}}function b(r,c){if(1&r){const o=t.RV6();t.j41(0,"ion-button",24),t.bIt("click",function(){t.eBV(o);const n=t.XpG().$implicit,i=t.XpG();return t.Njj(i.decreaseCount(n))}),t.nrm(1,"ion-icon",25),t.k0s()}if(2&r){const o=t.XpG().$implicit,e=t.XpG();t.Y8G("color",e.getButtonColor(o))}}function y(r,c){1&r&&(t.j41(0,"p",26),t.EFF(1," \xa1Stock m\xe1ximo! "),t.k0s())}function x(r,c){if(1&r){const o=t.RV6();t.j41(0,"ion-button",24),t.bIt("click",function(){t.eBV(o);const n=t.XpG().$implicit,i=t.XpG();return t.Njj(i.increaseCount(n))}),t.nrm(1,"ion-icon",27),t.k0s()}if(2&r){const o=t.XpG().$implicit,e=t.XpG();t.Y8G("color",e.getButtonColor(o))}}function I(r,c){if(1&r){const o=t.RV6();t.j41(0,"ion-button",28),t.bIt("click",function(){t.eBV(o);const n=t.XpG().$implicit,i=t.XpG();return t.Njj(i.confirmAction(n))}),t.EFF(1," OK "),t.k0s()}if(2&r){const o=t.XpG().$implicit,e=t.XpG();t.Y8G("color",e.getButtonColor(o))}}function M(r,c){if(1&r){const o=t.RV6();t.j41(0,"ion-item-options",29)(1,"ion-item-option",30),t.bIt("click",function(){t.eBV(o);const n=t.XpG().$implicit,i=t.XpG();return t.Njj(i.handleClick(n))}),t.EFF(2," Ver producto "),t.k0s()()}}function k(r,c){if(1&r&&(t.j41(0,"ion-item-sliding",null,0)(2,"ion-item",10)(3,"div",11)(4,"ion-thumbnail",12),t.nrm(5,"ion-img",13),t.k0s(),t.j41(6,"ion-label")(7,"h2",14),t.EFF(8),t.k0s(),t.j41(9,"p"),t.EFF(10),t.k0s(),t.j41(11,"p"),t.EFF(12),t.k0s()()(),t.j41(13,"div",15)(14,"div",16),t.EFF(15),t.k0s(),t.j41(16,"div",17),t.DNE(17,b,2,1,"ion-button",18),t.j41(18,"div",19)(19,"span",20),t.EFF(20),t.k0s(),t.DNE(21,y,2,0,"p",21),t.k0s(),t.DNE(22,x,2,1,"ion-button",18),t.k0s(),t.DNE(23,I,2,1,"ion-button",22),t.k0s()(),t.DNE(24,M,3,0,"ion-item-options",23),t.k0s()),2&r){const o=c.$implicit,e=t.XpG();t.R7$(5),t.FS9("alt",null==o?null:o.product_name),t.Y8G("src",e.imageState.getImageUrl(o)),t.R7$(3),t.JRh(null==o?null:o.product_name),t.R7$(2),t.SpI("Proveedor: ",null==o?null:o.provider_name,""),t.R7$(2),t.SpI("Precio a Cr\xe9dito: $",null==o?null:o.credit_price,""),t.R7$(3),t.SpI(" ",e.getDynamicText(o)," "),t.R7$(2),t.Y8G("ngIf",e.isAdmin),t.R7$(3),t.JRh(null==o?null:o.current_count),t.R7$(),t.Y8G("ngIf",(null==o?null:o.current_count)===(null==o?null:o.max_amount)),t.R7$(),t.Y8G("ngIf",e.isAdmin),t.R7$(),t.Y8G("ngIf",e.isAdmin),t.R7$(),t.Y8G("ngIf",e.isAdmin&&o)}}function O(r,c){if(1&r){const o=t.RV6();t.j41(0,"ion-button",31),t.bIt("click",function(){t.eBV(o);const n=t.XpG();return t.Njj(n.loadMoreProducts())}),t.EFF(1," Mostrar m\xe1s "),t.k0s()}}const S=[{path:"",component:(()=>{var r;class c{constructor(e,n,i,l,g){this.inventoryService=e,this.router=n,this.authService=i,this.cdr=l,this.imageState=g,this.products=[],this.filteredProducts=[],this.displayedProducts=[],this.searchTerm="",this.isAdmin=!1,this.selectedCategory="",this.selectedSubCategory="",this.selectedSort="recent",this.categories=[],this.subCategories=[],this.currentPage=1,this.itemsPerPage=10,this.lastClickTime=0,this.doubleClickDelay=300}ngOnInit(){console.log("Inicializando p\xe1gina de inventario..."),this.isAdmin=this.authService.isAdmin(),this.fetchProducts(),this.fetchCategories(),this.fetchSubCategories()}handleClick(e){console.log("Click detectado, llamando a viewProduct dos veces..."),this.viewProduct(e),setTimeout(()=>{this.viewProduct(e)},100)}fetchProducts(){this.inventoryService.getProducts(this.searchTerm).subscribe(e=>{e&&e.success?(this.products=e.data.map(n=>this.normalizeProduct(n)),this.products.forEach(n=>this.initializeProducts(n)),this.assignValuesToProducts(),this.filteredProducts=this.products,this.applyFilters(),this.loadMoreProducts(),this.cdr.detectChanges()):console.warn("Respuesta no v\xe1lida de la API:",e)},e=>{console.error("Error al obtener productos:",e)})}assignValuesToProducts(){this.products.forEach(e=>{e.sub_category_id||(e.sub_category_id=null),e.category_id||(e.category_id=null)})}fetchCategories(){this.inventoryService.getCategories().subscribe(e=>{e.success&&(this.categories=e.data)},e=>{console.error("Error al obtener categor\xedas:",e)})}fetchSubCategories(){this.inventoryService.getSubCategories().subscribe(e=>{e.success&&(this.subCategories=e.data)},e=>{console.error("Error al obtener subcategor\xedas:",e)})}onSearchChange(e){console.log("T\xe9rmino de b\xfasqueda:",this.searchTerm);const n=this.normalizeText(this.searchTerm.toLowerCase());if(!n)return void this.applyFilters();const i=n.split(" ").filter(g=>g.length>0);this.filteredProducts=(this.selectedCategory||this.selectedSubCategory?this.filteredProducts:this.products).filter(g=>{const j=this.normalizeText(g.product_name.toLowerCase()),w=this.normalizeText(g.provider_name.toLowerCase()),E=g.product_id.toString();return i.every(P=>j.includes(P)||w.includes(P)||E.includes(P))}),console.log("Productos filtrados:",this.filteredProducts),this.currentPage=1,this.displayedProducts=[],this.loadMoreProducts(),this.cdr.detectChanges()}normalizeText(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}applyFilters(){let e=[...this.products];if(this.selectedCategory){const n=Number(this.selectedCategory);e=e.filter(i=>i&&i.category_id===n)}if(this.selectedSubCategory){const n=Number(this.selectedSubCategory);e=e.filter(i=>i&&(i.sub_category_id===n||!i.sub_category_id))}"recent"===this.selectedSort?e=e.sort((n,i)=>new Date(i.updated_at).getTime()-new Date(n.updated_at).getTime()):"alphabetical"===this.selectedSort&&(e=e.sort((n,i)=>n.product_name.localeCompare(i.product_name))),this.filteredProducts=e.map(n=>this.normalizeProduct(n)),this.currentPage=1,this.displayedProducts=[],this.loadMoreProducts(),this.cdr.detectChanges()}normalizeProduct(e){return{image_url:e.image_url||"assets/product_placeholder.png",product_id:e.product_id||0,product_name:e.product_name||"Producto sin nombre",credit_price:e.credit_price||0,updated_at:e.updated_at||(new Date).toISOString(),category_id:e.category_id||null,current_count:e.current_count||0,current_stock:e.current_stock||0,max_amount:e.max_amount||0,prov_price:e.prov_price||"0.00",provider_name:e.provider_name||"Proveedor desconocido",sub_category_id:e.sub_category_id||null}}loadMoreProducts(){const e=(this.currentPage-1)*this.itemsPerPage,i=this.filteredProducts.slice(e,e+this.itemsPerPage);this.displayedProducts=this.displayedProducts.concat(i),this.currentPage++}showMoreProducts(){this.currentPage++,this.loadMoreProducts()}onCategoryChange(e){this.selectedCategory=e.detail.value,this.selectedSubCategory="",this.applyFilters()}onSubCategoryChange(e){this.selectedSubCategory=e.detail.value,this.applyFilters()}hasMoreProducts(){return this.displayedProducts.length<this.filteredProducts.length}viewProduct(e){console.log("M\xe9todo viewProduct ejecutado"),e&&e.product_id?(e.sub_category_id||(console.warn("El producto no tiene sub_category_id:",e),e.sub_category_id=null),console.log("Producto seleccionado:",e.product_id),console.log("Estado del producto:",e),this.router.navigate(["/producto",e.product_id])):console.error("El producto no est\xe1 completamente cargado o falta informaci\xf3n:",e)}increaseCount(e){e.current_count<e.max_amount?e.current_count=e.current_count?e.current_count+1:e.current_stock+1:(console.warn(`No se puede incrementar, valor m\xe1ximo alcanzado (${e.max_amount})`),alert(`Has alcanzado el stock m\xe1ximo permitido: ${e.max_amount}`))}decreaseCount(e){e.current_count>0&&e.current_count--}confirmAction(e){const n=e.current_count-e.current_stock;0!==n&&this.inventoryService.updateInventory(e.product_id,n).subscribe({next:i=>{i.success?(e.current_stock=i.new_stock,e.current_count=i.new_stock):console.warn("Error al actualizar el stock:",i.message)},error:i=>{console.error("Error al realizar la solicitud:",i)}})}getButtonColor(e){return e.current_count>e.current_stock?"success":e.current_count<e.current_stock?"danger":"medium"}getDynamicText(e){return e.current_count>e.current_stock?"Agregar a Stock":e.current_count<e.current_stock?"Venta":e.current_count===e.current_stock?"Stock Disponible":"None"}initializeProducts(e){typeof e.current_stock<"u"?e.current_count=e.current_stock:(console.warn("current_stock no est\xe1 definido para el producto:",e),e.current_count=0)}onDrag(e,n){if(console.log("Evento ionDrag detectado"),!n||!n.product_id||!n.sub_category_id)return console.warn("El producto no est\xe1 completamente cargado:",n),void e.close();e.getSlidingRatio().then(i=>{console.log("Proporci\xf3n del deslizamiento (ratio):",i),i>1&&(console.log("Deslizamiento completado, ejecutando viewProduct..."),setTimeout(()=>{this.viewProduct(n),e.close()},100))}).catch(i=>{console.error("Error al obtener la proporci\xf3n del deslizamiento:",i)})}ionViewDidEnter(){var e;const n=this.router.getCurrentNavigation();null!=n&&null!==(e=n.extras)&&void 0!==e&&null!==(e=e.state)&&void 0!==e&&e.timestamp&&(this.fetchProducts(),this.fetchCategories(),this.fetchSubCategories())}}return(r=c).\u0275fac=function(e){return new(e||r)(t.rXU(f.c),t.rXU(d.Ix),t.rXU(s.u),t.rXU(t.gRc),t.rXU(p.S))},r.\u0275cmp=t.VBU({type:r,selectors:[["app-inventario"]],decls:24,vars:6,consts:[["slidingItem",""],["placeholder","Nombre o Proveedor",3,"ngModelChange","ionInput","ngModel"],[3,"ngModelChange","ionChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["value","recent"],["value","alphabetical"],[4,"ngFor","ngForOf"],["expand","full",3,"click",4,"ngIf"],[3,"value"],[1,"inventory-item"],[1,"left-info"],["slot","start"],["loading","lazy",3,"src","alt"],[1,"product-name"],[1,"counter-container"],[1,"dynamic-text"],[1,"counter-controls"],["fill","clear","size","small",3,"color","click",4,"ngIf"],[1,"counter-value-container"],[1,"counter-value"],["class","warning-text",4,"ngIf"],["expand","block","size","small","class","confirm-button",3,"color","click",4,"ngIf"],["side","end",4,"ngIf"],["fill","clear","size","small",3,"click","color"],["name","remove-circle-outline"],[1,"warning-text"],["name","add-circle-outline"],["expand","block","size","small",1,"confirm-button",3,"click","color"],["side","end"],[3,"click"],["expand","full",3,"click"]],template:function(e,n){1&e&&(t.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),t.EFF(3,"Inventario"),t.k0s()()(),t.j41(4,"ion-content")(5,"ion-list")(6,"ion-searchbar",1),t.mxI("ngModelChange",function(l){return t.DH7(n.searchTerm,l)||(n.searchTerm=l),l}),t.bIt("ionInput",function(l){return n.onSearchChange(l)}),t.k0s(),t.j41(7,"ion-item")(8,"ion-label"),t.EFF(9,"Subcategor\xeda"),t.k0s(),t.j41(10,"ion-select",2),t.mxI("ngModelChange",function(l){return t.DH7(n.selectedSubCategory,l)||(n.selectedSubCategory=l),l}),t.bIt("ionChange",function(){return n.applyFilters()}),t.j41(11,"ion-select-option",3),t.EFF(12,"Todas"),t.k0s(),t.DNE(13,v,2,2,"ion-select-option",4),t.k0s()(),t.j41(14,"ion-item")(15,"ion-label"),t.EFF(16,"Ordenar por"),t.k0s(),t.j41(17,"ion-select",2),t.mxI("ngModelChange",function(l){return t.DH7(n.selectedSort,l)||(n.selectedSort=l),l}),t.bIt("ionChange",function(){return n.applyFilters()}),t.j41(18,"ion-select-option",5),t.EFF(19,"Agregado reciente"),t.k0s(),t.j41(20,"ion-select-option",6),t.EFF(21,"Alfab\xe9tico"),t.k0s()()(),t.DNE(22,k,25,12,"ion-item-sliding",7)(23,O,2,0,"ion-button",8),t.k0s()()),2&e&&(t.R7$(6),t.R50("ngModel",n.searchTerm),t.R7$(4),t.R50("ngModel",n.selectedSubCategory),t.R7$(3),t.Y8G("ngForOf",n.subCategories),t.R7$(4),t.R50("ngModel",n.selectedSort),t.R7$(5),t.Y8G("ngForOf",n.displayedProducts),t.R7$(),t.Y8G("ngIf",n.hasMoreProducts()))},dependencies:[_.Sq,_.bT,h.BC,h.vS,a.Jm,a.W9,a.eU,a.iq,a.KW,a.uz,a.LU,a.CE,a.A7,a.he,a.nf,a.S1,a.Nm,a.Ip,a.Zx,a.BC,a.ai,a.Je,a.Gw],styles:['@charset "UTF-8";ion-list[_ngcontent-%COMP%]{margin:10px;border-radius:15px;overflow:hidden;background-color:#fff;box-shadow:0 2px 8px #0000001a}ion-item[_ngcontent-%COMP%]{--background: #fff;margin:5px 0;border-radius:10px;padding:0 10px;display:flex;align-items:center;transition:transform .2s ease,box-shadow .2s ease}ion-item[_ngcontent-%COMP%]:hover{transform:scale(1.02);box-shadow:0 4px 12px #00000026}ion-thumbnail[_ngcontent-%COMP%]{width:80px;height:80px;border-radius:10px;overflow:hidden}ion-img[_ngcontent-%COMP%]{object-fit:cover;width:100%;height:100%}ion-label[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1rem;font-weight:700;color:#333;margin:0}ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.9rem;color:#666;margin:2px 0}.product-price[_ngcontent-%COMP%]{font-size:1rem;font-weight:700;color:#444;margin-left:auto;display:flex;align-items:center;justify-content:center}@media (min-width: 768px){.counter-container[_ngcontent-%COMP%]{padding:0 0 10px}ion-list[_ngcontent-%COMP%]{max-width:700px;margin:20px auto}ion-item[_ngcontent-%COMP%]{--background: #f9f9f9;padding:15px}ion-thumbnail[_ngcontent-%COMP%]{width:100px;height:100px}ion-label[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.2rem}ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1rem}.product-price[_ngcontent-%COMP%]{font-size:1.1rem}}ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.85rem;color:#666;margin:2px 0}ion-list.list-ios[_ngcontent-%COMP%]   ion-item.item[_ngcontent-%COMP%]   div.item-native[_ngcontent-%COMP%]{border-bottom:none}.counter-container[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;margin-left:auto;flex-direction:column;justify-content:space-evenly;height:100%;padding:10px 0}.counter-container[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{margin:0}.small-text[_ngcontent-%COMP%]{font-size:.8rem;color:var(--ion-color-medium);text-align:center}.confirm-button[_ngcontent-%COMP%]{transition:transform .2s}.confirm-button[_ngcontent-%COMP%]:active{transform:scale(1.1)}.current-stk[_ngcontent-%COMP%]{display:flex;height:100%;justify-content:space-evenly;align-items:center}.dynamic-text[_ngcontent-%COMP%]{width:150px;text-align:center;font-size:.9rem;font-weight:700;min-height:1.5rem}.container-stock[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-evenly}.mid-two[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-around;height:100%}.inventory-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.counter-controls[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:10px}.counter-value-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;min-width:70px}.counter-value[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:var(--ion-color-medium)}.stock-label[_ngcontent-%COMP%]{font-size:.8rem;color:var(--ion-color-medium)}.dynamic-text[_ngcontent-%COMP%]{font-size:.9rem;font-weight:700;color:var(--ion-color-primary)}.confirm-button[_ngcontent-%COMP%]{width:100%;max-width:80px;margin-top:5px;transition:transform .2s}.confirm-button[_ngcontent-%COMP%]:active{transform:scale(1.05)}.confirm-button[_ngcontent-%COMP%]::navitve{color:#fff}.left-info[_ngcontent-%COMP%]{display:flex;flex-direction:row;width:100%;align-items:center;justify-content:flex-start}ion-thumbnail[_ngcontent-%COMP%]{padding:7px;margin-right:20px}@media (max-width: 450px){.left-info[_ngcontent-%COMP%]{flex-direction:column;align-items:center}ion-label[_ngcontent-%COMP%]{text-align:center}ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.75rem;text-align:center}ion-list[_ngcontent-%COMP%]{max-width:700px;margin:10px auto 0}}ion-item.inventory-item[_ngcontent-%COMP%]::part(native){padding-left:0}.warning-text[_ngcontent-%COMP%]{color:red;font-size:.6rem;text-align:center;margin-top:5px}']}),c})()}];let F=(()=>{var r;class c{}return(r=c).\u0275fac=function(e){return new(e||r)},r.\u0275mod=t.$C({type:r}),r.\u0275inj=t.G2t({imports:[d.iI.forChild(S),d.iI]}),c})(),$=(()=>{var r;class c{}return(r=c).\u0275fac=function(e){return new(e||r)},r.\u0275mod=t.$C({type:r}),r.\u0275inj=t.G2t({imports:[_.MD,h.YN,a.bv,F]}),c})()},4934:(C,m,u)=>{u.d(m,{c:()=>a});var _=u(4438),h=u(1626);let a=(()=>{var d;class t{constructor(s){this.http=s,this.apiUrl="https://muebleriasolaris.com/ionic-products"}getProducts(s=""){return encodeURIComponent(s),this.http.get(`${this.apiUrl}/inventory_info.php`)}getProductsByProvider(s){return this.http.get(`${this.apiUrl}/inventory_info_by_id.php?provider_id=${s}`)}getProviders(){return this.http.get(`${this.apiUrl}/providers.php`)}getProviderById(s){return this.http.get(`${this.apiUrl}/providers.php?id=${s}`)}saveProvider(s){return this.http.post(`${this.apiUrl}/save_provider.php`,s)}getCategories(){return this.http.get(`${this.apiUrl}/categories.php`)}getBrands(){return this.http.get(`${this.apiUrl}/brands.php`)}saveInventory(){return this.http.get(`${this.apiUrl}/save_inventory.php`)}saveBrand(s){return this.http.post(`${this.apiUrl}/save_brand.php`,s,{headers:{"Content-Type":"application/json"}})}deleteBrand(s){return this.http.post(`${this.apiUrl}/delete_brand.php`,{id:s})}getSubCategories(){return this.http.get(`${this.apiUrl}/sub_categories.php`)}saveProduct(s){return this.http.post(`${this.apiUrl}/save_product.php`,s)}addInventory(s){return this.http.post(`${this.apiUrl}/save_new_product.php`,s)}updateInventory(s,p){return this.http.post(`${this.apiUrl}/update_inventory.php`,{id_product:s,adjustment:p})}deleteProduct(s){return this.http.post(`${this.apiUrl}/delete_product.php`,{product_id:s})}deleteProvider(s){return this.http.post(`${this.apiUrl}/delete_provider.php`,{id:s})}updateProvider(s){return this.http.post(`${this.apiUrl}/update_provider.php`,s)}syncStock(s){return this.http.get(`${this.apiUrl}/inventory_info.php?product_id=${s}`)}}return(d=t).\u0275fac=function(s){return new(s||d)(_.KVO(h.Qq))},d.\u0275prov=_.jDH({token:d,factory:d.\u0275fac,providedIn:"root"}),t})()}}]);