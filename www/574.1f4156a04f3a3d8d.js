"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[574],{574:(F,m,a)=>{a.d(m,{X:()=>_});var l,h=a(1413),e=a(4438),f=a(4934),p=a(5520),P=a(4796),C=a(4191),d=a(177),g=a(4341),c=a(7125);function v(r,t){if(1&r&&(e.j41(0,"ion-select-option",9),e.EFF(1),e.k0s()),2&r){const n=t.$implicit;e.Y8G("value",n.id),e.R7$(),e.SpI(" ",n.name," ")}}function b(r,t){if(1&r){const n=e.RV6();e.j41(0,"ion-button",24),e.bIt("click",function(){e.eBV(n);const i=e.XpG().$implicit,s=e.XpG();return e.Njj(s.decreaseCount(i))}),e.nrm(1,"ion-icon",25),e.k0s()}if(2&r){const n=e.XpG().$implicit,o=e.XpG();e.Y8G("color",o.getButtonColor(n))}}function x(r,t){1&r&&(e.j41(0,"p",26),e.EFF(1," \xa1Stock m\xe1ximo! "),e.k0s())}function M(r,t){if(1&r){const n=e.RV6();e.j41(0,"ion-button",24),e.bIt("click",function(){e.eBV(n);const i=e.XpG().$implicit,s=e.XpG();return e.Njj(s.increaseCount(i))}),e.nrm(1,"ion-icon",27),e.k0s()}if(2&r){const n=e.XpG().$implicit,o=e.XpG();e.Y8G("color",o.getButtonColor(n))}}function y(r,t){if(1&r){const n=e.RV6();e.j41(0,"ion-button",28),e.bIt("click",function(){e.eBV(n);const i=e.XpG().$implicit,s=e.XpG();return e.Njj(s.confirmAction(i))}),e.EFF(1," OK "),e.k0s()}if(2&r){const n=e.XpG().$implicit,o=e.XpG();e.Y8G("color",o.getButtonColor(n))}}function O(r,t){if(1&r){const n=e.RV6();e.j41(0,"ion-item-options",29)(1,"ion-item-option",30),e.bIt("click",function(){e.eBV(n);const i=e.XpG().$implicit,s=e.XpG();return e.Njj(s.handleClick(i))}),e.EFF(2," Ver producto "),e.k0s()()}}function I(r,t){if(1&r&&(e.j41(0,"ion-item-sliding",null,0)(2,"ion-item",10)(3,"div",11)(4,"ion-thumbnail",12),e.nrm(5,"ion-img",13),e.k0s(),e.j41(6,"ion-label")(7,"h2",14),e.EFF(8),e.k0s(),e.j41(9,"p"),e.EFF(10),e.k0s(),e.j41(11,"p"),e.EFF(12),e.k0s()()(),e.j41(13,"div",15)(14,"div",16),e.EFF(15),e.k0s(),e.j41(16,"div",17),e.DNE(17,b,2,1,"ion-button",18),e.j41(18,"div",19)(19,"span",20),e.EFF(20),e.k0s(),e.DNE(21,x,2,0,"p",21),e.k0s(),e.DNE(22,M,2,1,"ion-button",18),e.k0s(),e.DNE(23,y,2,1,"ion-button",22),e.k0s()(),e.DNE(24,O,3,0,"ion-item-options",23),e.k0s()),2&r){const n=t.$implicit,o=e.XpG();e.R7$(5),e.FS9("alt",null==n?null:n.product_name),e.Y8G("src",o.imageState.getImageUrl(n)),e.R7$(3),e.JRh(null==n?null:n.product_name),e.R7$(2),e.SpI("Proveedor: ",null==n?null:n.provider_name,""),e.R7$(2),e.SpI("Precio a Cr\xe9dito: $",null==n?null:n.credit_price,""),e.R7$(3),e.SpI(" ",o.getDynamicText(n)," "),e.R7$(2),e.Y8G("ngIf",o.isAdmin),e.R7$(3),e.JRh(null==n?null:n.current_count),e.R7$(),e.Y8G("ngIf",(null==n?null:n.current_count)===(null==n?null:n.max_amount)),e.R7$(),e.Y8G("ngIf",o.isAdmin),e.R7$(),e.Y8G("ngIf",o.isAdmin),e.R7$(),e.Y8G("ngIf",o.isAdmin&&n)}}function k(r,t){if(1&r){const n=e.RV6();e.j41(0,"ion-button",31),e.bIt("click",function(){e.eBV(n);const i=e.XpG();return e.Njj(i.loadMoreProducts())}),e.EFF(1," Mostrar m\xe1s "),e.k0s()}}class _{constructor(t,n,o,i,s){this.inventoryService=t,this.router=n,this.authService=o,this.cdr=i,this.imageState=s,this.products=[],this.filteredProducts=[],this.displayedProducts=[],this.searchTerm="",this.isAdmin=!1,this.selectedCategory="",this.selectedSubCategory="",this.selectedSort="recent",this.categories=[],this.subCategories=[],this.currentPage=1,this.itemsPerPage=5,this.lastClickTime=0,this.doubleClickDelay=300}ngOnInit(){console.log("Inicializando p\xe1gina de inventario..."),this.isAdmin=this.authService.isAdmin(),_.refreshData.subscribe(()=>{this.fetchProducts(),this.fetchCategories(),this.fetchSubCategories()}),this.fetchProducts(),this.fetchCategories(),this.fetchSubCategories()}handleClick(t){console.log("Click detectado, llamando a viewProduct dos veces..."),this.viewProduct(t),setTimeout(()=>{this.viewProduct(t)},100)}fetchProducts(){this.inventoryService.getProducts(this.searchTerm).subscribe(t=>{t&&t.success?(this.products=t.data.map(n=>this.normalizeProduct(n)),this.products.forEach(n=>this.initializeProducts(n)),this.assignValuesToProducts(),this.filteredProducts=this.products,this.applyFilters(),this.loadMoreProducts(),this.cdr.detectChanges()):console.warn("Respuesta no v\xe1lida de la API:",t)},t=>{console.error("Error al obtener productos:",t)})}assignValuesToProducts(){this.products.forEach(t=>{t.sub_category_id||(t.sub_category_id=null),t.category_id||(t.category_id=null)})}fetchCategories(){this.inventoryService.getCategories().subscribe(t=>{t.success&&(this.categories=t.data)},t=>{console.error("Error al obtener categor\xedas:",t)})}fetchSubCategories(){this.inventoryService.getSubCategories().subscribe(t=>{t.success&&(this.subCategories=t.data)},t=>{console.error("Error al obtener subcategor\xedas:",t)})}onSearchChange(t){console.log("T\xe9rmino de b\xfasqueda:",this.searchTerm);const n=this.normalizeText(this.searchTerm.toLowerCase());if(!n)return void this.applyFilters();const o=n.split(" ").filter(s=>s.length>0);this.filteredProducts=(this.selectedCategory||this.selectedSubCategory?this.filteredProducts:this.products).filter(s=>{const E=this.normalizeText(s.product_name.toLowerCase()),T=this.normalizeText(s.provider_name.toLowerCase()),S=s.product_id.toString();return o.every(u=>E.includes(u)||T.includes(u)||S.includes(u))}),console.log("Productos filtrados:",this.filteredProducts),this.currentPage=1,this.displayedProducts=[],this.loadMoreProducts(),this.cdr.detectChanges()}normalizeText(t){return t.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}applyFilters(){let t=[...this.products];if(this.selectedCategory){const n=Number(this.selectedCategory);t=t.filter(o=>o&&o.category_id===n)}if(this.selectedSubCategory){const n=Number(this.selectedSubCategory);t=t.filter(o=>o&&(o.sub_category_id===n||!o.sub_category_id))}"recent"===this.selectedSort?t=t.sort((n,o)=>new Date(o.updated_at).getTime()-new Date(n.updated_at).getTime()):"alphabetical"===this.selectedSort&&(t=t.sort((n,o)=>n.product_name.localeCompare(o.product_name))),this.filteredProducts=t.map(n=>this.normalizeProduct(n)),this.currentPage=1,this.displayedProducts=[],this.loadMoreProducts(),this.cdr.detectChanges()}normalizeProduct(t){return{image_url:t.image_url||"assets/product_placeholder.png",product_id:t.product_id||0,product_name:t.product_name||"Producto sin nombre",credit_price:t.credit_price||0,updated_at:t.updated_at||(new Date).toISOString(),category_id:t.category_id||null,current_count:t.current_count||0,current_stock:t.current_stock||0,max_amount:t.max_amount||0,prov_price:t.prov_price||"0.00",provider_name:t.provider_name||"Proveedor desconocido",sub_category_id:t.sub_category_id||null}}loadMoreProducts(){const t=(this.currentPage-1)*this.itemsPerPage,o=this.filteredProducts.slice(t,t+this.itemsPerPage);this.displayedProducts=this.displayedProducts.concat(o),this.currentPage++}showMoreProducts(){this.currentPage++,this.loadMoreProducts()}onCategoryChange(t){this.selectedCategory=t.detail.value,this.selectedSubCategory="",this.applyFilters()}onSubCategoryChange(t){this.selectedSubCategory=t.detail.value,this.applyFilters()}hasMoreProducts(){return this.displayedProducts.length<this.filteredProducts.length}viewProduct(t){console.log("M\xe9todo viewProduct ejecutado"),t&&t.product_id?(t.sub_category_id||(console.warn("El producto no tiene sub_category_id:",t),t.sub_category_id=null),console.log("Producto seleccionado:",t.product_id),console.log("Estado del producto:",t),this.router.navigate(["/producto",t.product_id])):console.error("El producto no est\xe1 completamente cargado o falta informaci\xf3n:",t)}increaseCount(t){t.current_count<t.max_amount?t.current_count=t.current_count?t.current_count+1:t.current_stock+1:(console.warn(`No se puede incrementar, valor m\xe1ximo alcanzado (${t.max_amount})`),alert(`Has alcanzado el stock m\xe1ximo permitido: ${t.max_amount}`))}decreaseCount(t){t.current_count>0&&t.current_count--}confirmAction(t){const n=t.current_count-t.current_stock;0!==n&&this.inventoryService.updateInventory(t.product_id,n).subscribe({next:o=>{o.success?(t.current_stock=o.new_stock,t.current_count=o.new_stock):console.warn("Error al actualizar el stock:",o.message)},error:o=>{console.error("Error al realizar la solicitud:",o)}})}getButtonColor(t){return t.current_count>t.current_stock?"success":t.current_count<t.current_stock?"danger":"medium"}getDynamicText(t){return t.current_count>t.current_stock?"Agregar a Stock":t.current_count<t.current_stock?"Venta":t.current_count===t.current_stock?"Stock Disponible":"None"}initializeProducts(t){typeof t.current_stock<"u"?t.current_count=t.current_stock:(console.warn("current_stock no est\xe1 definido para el producto:",t),t.current_count=0)}onDrag(t,n){if(console.log("Evento ionDrag detectado"),!n||!n.product_id||!n.sub_category_id)return console.warn("El producto no est\xe1 completamente cargado:",n),void t.close();t.getSlidingRatio().then(o=>{console.log("Proporci\xf3n del deslizamiento (ratio):",o),o>1&&(console.log("Deslizamiento completado, ejecutando viewProduct..."),setTimeout(()=>{this.viewProduct(n),t.close()},100))}).catch(o=>{console.error("Error al obtener la proporci\xf3n del deslizamiento:",o)})}ionViewDidEnter(){var t;const n=this.router.getCurrentNavigation();null!=n&&null!==(t=n.extras)&&void 0!==t&&null!==(t=t.state)&&void 0!==t&&t.timestamp&&(this.fetchProducts(),this.fetchCategories(),this.fetchSubCategories())}}(l=_).refreshData=new h.B,l.\u0275fac=function(t){return new(t||l)(e.rXU(f.c),e.rXU(p.Ix),e.rXU(P.u),e.rXU(e.gRc),e.rXU(C.S))},l.\u0275cmp=e.VBU({type:l,selectors:[["app-inventario"]],decls:24,vars:6,consts:[["slidingItem",""],["placeholder","Nombre o Proveedor",3,"ngModelChange","ionInput","ngModel"],[3,"ngModelChange","ionChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["value","recent"],["value","alphabetical"],[4,"ngFor","ngForOf"],["expand","full",3,"click",4,"ngIf"],[3,"value"],[1,"inventory-item"],[1,"left-info"],["slot","start"],["loading","lazy",3,"src","alt"],[1,"product-name"],[1,"counter-container"],[1,"dynamic-text"],[1,"counter-controls"],["fill","clear","size","small",3,"color","click",4,"ngIf"],[1,"counter-value-container"],[1,"counter-value"],["class","warning-text",4,"ngIf"],["expand","block","size","small","class","confirm-button",3,"color","click",4,"ngIf"],["side","end",4,"ngIf"],["fill","clear","size","small",3,"click","color"],["name","remove-circle-outline"],[1,"warning-text"],["name","add-circle-outline"],["expand","block","size","small",1,"confirm-button",3,"click","color"],["side","end"],[3,"click"],["expand","full",3,"click"]],template:function(t,n){1&t&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e.EFF(3,"Inventario"),e.k0s()()(),e.j41(4,"ion-content")(5,"ion-list")(6,"ion-searchbar",1),e.mxI("ngModelChange",function(i){return e.DH7(n.searchTerm,i)||(n.searchTerm=i),i}),e.bIt("ionInput",function(i){return n.onSearchChange(i)}),e.k0s(),e.j41(7,"ion-item")(8,"ion-label"),e.EFF(9,"Subcategor\xeda"),e.k0s(),e.j41(10,"ion-select",2),e.mxI("ngModelChange",function(i){return e.DH7(n.selectedSubCategory,i)||(n.selectedSubCategory=i),i}),e.bIt("ionChange",function(){return n.applyFilters()}),e.j41(11,"ion-select-option",3),e.EFF(12,"Todas"),e.k0s(),e.DNE(13,v,2,2,"ion-select-option",4),e.k0s()(),e.j41(14,"ion-item")(15,"ion-label"),e.EFF(16,"Ordenar por"),e.k0s(),e.j41(17,"ion-select",2),e.mxI("ngModelChange",function(i){return e.DH7(n.selectedSort,i)||(n.selectedSort=i),i}),e.bIt("ionChange",function(){return n.applyFilters()}),e.j41(18,"ion-select-option",5),e.EFF(19,"Agregado reciente"),e.k0s(),e.j41(20,"ion-select-option",6),e.EFF(21,"Alfab\xe9tico"),e.k0s()()(),e.DNE(22,I,25,12,"ion-item-sliding",7)(23,k,2,0,"ion-button",8),e.k0s()()),2&t&&(e.R7$(6),e.R50("ngModel",n.searchTerm),e.R7$(4),e.R50("ngModel",n.selectedSubCategory),e.R7$(3),e.Y8G("ngForOf",n.subCategories),e.R7$(4),e.R50("ngModel",n.selectedSort),e.R7$(5),e.Y8G("ngForOf",n.displayedProducts),e.R7$(),e.Y8G("ngIf",n.hasMoreProducts()))},dependencies:[d.Sq,d.bT,g.BC,g.vS,c.Jm,c.W9,c.eU,c.iq,c.KW,c.uz,c.LU,c.CE,c.A7,c.he,c.nf,c.S1,c.Nm,c.Ip,c.Zx,c.BC,c.ai,c.Je,c.Gw],styles:['@charset "UTF-8";ion-list[_ngcontent-%COMP%]{margin:10px;border-radius:15px;overflow:hidden;background-color:#fff;box-shadow:0 2px 8px #0000001a}ion-item[_ngcontent-%COMP%]{--background: #fff;margin:5px 0;border-radius:10px;padding:0 10px;display:flex;align-items:center;transition:transform .2s ease,box-shadow .2s ease}ion-item[_ngcontent-%COMP%]:hover{transform:scale(1.02);box-shadow:0 4px 12px #00000026}ion-thumbnail[_ngcontent-%COMP%]{width:80px;height:80px;border-radius:10px;overflow:hidden}ion-img[_ngcontent-%COMP%]{object-fit:cover;width:100%;height:100%}ion-label[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1rem;font-weight:700;color:#333;margin:0}ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.9rem;color:#666;margin:2px 0}.product-price[_ngcontent-%COMP%]{font-size:1rem;font-weight:700;color:#444;margin-left:auto;display:flex;align-items:center;justify-content:center}@media (min-width: 768px){.counter-container[_ngcontent-%COMP%]{padding:0 0 10px}ion-list[_ngcontent-%COMP%]{max-width:700px;margin:20px auto}ion-item[_ngcontent-%COMP%]{--background: #f9f9f9;padding:15px}ion-thumbnail[_ngcontent-%COMP%]{width:100px;height:100px}ion-label[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.2rem}ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1rem}.product-price[_ngcontent-%COMP%]{font-size:1.1rem}}ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.85rem;color:#666;margin:2px 0}ion-list.list-ios[_ngcontent-%COMP%]   ion-item.item[_ngcontent-%COMP%]   div.item-native[_ngcontent-%COMP%]{border-bottom:none}.counter-container[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;margin-left:auto;flex-direction:column;justify-content:space-evenly;height:100%;padding:10px 0}.counter-container[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{margin:0}.small-text[_ngcontent-%COMP%]{font-size:.8rem;color:var(--ion-color-medium);text-align:center}.confirm-button[_ngcontent-%COMP%]{transition:transform .2s}.confirm-button[_ngcontent-%COMP%]:active{transform:scale(1.1)}.current-stk[_ngcontent-%COMP%]{display:flex;height:100%;justify-content:space-evenly;align-items:center}.dynamic-text[_ngcontent-%COMP%]{width:150px;text-align:center;font-size:.9rem;font-weight:700;min-height:1.5rem}.container-stock[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-evenly}.mid-two[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-around;height:100%}.inventory-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.counter-controls[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:10px}.counter-value-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;min-width:70px}.counter-value[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:var(--ion-color-medium)}.stock-label[_ngcontent-%COMP%]{font-size:.8rem;color:var(--ion-color-medium)}.dynamic-text[_ngcontent-%COMP%]{font-size:.9rem;font-weight:700;color:var(--ion-color-primary)}.confirm-button[_ngcontent-%COMP%]{width:100%;max-width:80px;margin-top:5px;transition:transform .2s}.confirm-button[_ngcontent-%COMP%]:active{transform:scale(1.05)}.confirm-button[_ngcontent-%COMP%]::navitve{color:#fff}.left-info[_ngcontent-%COMP%]{display:flex;flex-direction:row;width:100%;align-items:center;justify-content:flex-start}ion-thumbnail[_ngcontent-%COMP%]{padding:7px;margin-right:20px}@media (max-width: 450px){.left-info[_ngcontent-%COMP%]{flex-direction:column;align-items:center}ion-label[_ngcontent-%COMP%]{text-align:center}ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.75rem;text-align:center}ion-list[_ngcontent-%COMP%]{max-width:700px;margin:10px auto 0}}ion-item.inventory-item[_ngcontent-%COMP%]::part(native){padding-left:0}.warning-text[_ngcontent-%COMP%]{color:red;font-size:.6rem;text-align:center;margin-top:5px}']})}}]);